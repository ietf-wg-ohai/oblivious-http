<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Oblivious HTTP</title>
<meta content="Martin Thomson" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document describes Oblivious HTTP, a protocol for forwarding encrypted HTTP messages.
Oblivious HTTP allows a client to make multiple requests to an origin server without that server
being able to link those requests to the client or to identify the requests as having come from the
same client, while placing only limited trust in the nodes used to forward the messages. 
    " name="description">
<meta content="xml2rfc 3.18.2" name="generator">
<meta content="draft-ietf-ohai-ohttp-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.11.6
    ConfigArgParse 1.5.3
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.0.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.31.0
    setuptools 67.7.2
    six 1.16.0
    wcwidth 0.2.12
-->
<link href="draft-ietf-ohai-ohttp.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Oblivious HTTP</td>
<td class="right">December 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Thomson &amp; Wood</td>
<td class="center">Expires 6 June 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Oblivious HTTP Application Intermediation</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ohai-ohttp-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-12-04" class="published">4 December 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-06-06">6 June 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Thomson</div>
<div class="org">Mozilla</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Oblivious HTTP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes Oblivious HTTP, a protocol for forwarding encrypted HTTP messages.
Oblivious HTTP allows a client to make multiple requests to an origin server without that server
being able to link those requests to the client or to identify the requests as having come from the
same client, while placing only limited trust in the nodes used to forward the messages.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://ietf-wg-ohai.github.io/oblivious-http/draft-ietf-ohai-ohttp.html">https://ietf-wg-ohai.github.io/oblivious-http/draft-ietf-ohai-ohttp.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-ohai-ohttp/">https://datatracker.ietf.org/doc/draft-ietf-ohai-ohttp/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Oblivious HTTP Application Intermediation Working Group mailing list (<span><a href="mailto:ohai@ietf.org">mailto:ohai@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/ohai/">https://mailarchive.ietf.org/arch/browse/ohai/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/ohai/">https://www.ietf.org/mailman/listinfo/ohai/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/ietf-wg-ohai/oblivious-http">https://github.com/ietf-wg-ohai/oblivious-http</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 6 June 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-applicability" class="internal xref">Applicability</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-key-configuration" class="internal xref">Key Configuration</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-key-configuration-encoding" class="internal xref">Key Configuration Encoding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-key-configuration-media-typ" class="internal xref">Key Configuration Media Type</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-hpke-encapsulation" class="internal xref">HPKE Encapsulation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-request-format" class="internal xref">Request Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-response-format" class="internal xref">Response Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-encapsulation-of-requests" class="internal xref">Encapsulation of Requests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-encapsulation-of-responses" class="internal xref">Encapsulation of Responses</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-request-and-response-media-" class="internal xref">Request and Response Media Types</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-repurposing-the-encapsulati" class="internal xref">Repurposing the Encapsulation Format</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-http-usage" class="internal xref">HTTP Usage</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-informational-responses" class="internal xref">Informational Responses</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-errors" class="internal xref">Errors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-signaling-key-configuration" class="internal xref">Signaling Key Configuration Problems</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-client-responsibilities" class="internal xref">Client Responsibilities</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-relay-responsibilities" class="internal xref">Relay Responsibilities</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="auto internal xref">6.2.1</a>.  <a href="#name-differential-treatment" class="internal xref">Differential Treatment</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="auto internal xref">6.2.2</a>.  <a href="#name-denial-of-service" class="internal xref">Denial of Service</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.3">
                    <p id="section-toc.1-1.6.2.2.2.3.1"><a href="#section-6.2.3" class="auto internal xref">6.2.3</a>.  <a href="#name-traffic-analysis" class="internal xref">Traffic Analysis</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-server-responsibilities" class="internal xref">Server Responsibilities</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-key-management" class="internal xref">Key Management</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="auto internal xref">6.5</a>.  <a href="#name-replay-attacks" class="internal xref">Replay Attacks</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5.2.1">
                    <p id="section-toc.1-1.6.2.5.2.1.1"><a href="#section-6.5.1" class="auto internal xref">6.5.1</a>.  <a href="#name-use-of-date-for-anti-replay" class="internal xref">Use of Date for Anti-Replay</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5.2.2">
                    <p id="section-toc.1-1.6.2.5.2.2.1"><a href="#section-6.5.2" class="auto internal xref">6.5.2</a>.  <a href="#name-correcting-clock-difference" class="internal xref">Correcting Clock Differences</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="auto internal xref">6.6</a>.  <a href="#name-forward-secrecy" class="internal xref">Forward Secrecy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a href="#section-6.7" class="auto internal xref">6.7</a>.  <a href="#name-post-compromise-security" class="internal xref">Post-Compromise Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.8">
                <p id="section-toc.1-1.6.2.8.1"><a href="#section-6.8" class="auto internal xref">6.8</a>.  <a href="#name-client-clock-exposure" class="internal xref">Client Clock Exposure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.9">
                <p id="section-toc.1-1.6.2.9.1"><a href="#section-6.9" class="auto internal xref">6.9</a>.  <a href="#name-media-type-security" class="internal xref">Media Type Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.10">
                <p id="section-toc.1-1.6.2.10.1"><a href="#section-6.10" class="auto internal xref">6.10</a>. <a href="#name-separate-gateway-and-target" class="internal xref">Separate Gateway and Target</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-privacy-considerations" class="internal xref">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-operational-and-deployment-" class="internal xref">Operational and Deployment Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-performance-overhead" class="internal xref">Performance Overhead</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-resource-mappings" class="internal xref">Resource Mappings</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-network-management" class="internal xref">Network Management</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-application-ohttp-keys-medi" class="internal xref">application/ohttp-keys Media Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-message-ohttp-req-media-typ" class="internal xref">message/ohttp-req Media Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-message-ohttp-res-media-typ" class="internal xref">message/ohttp-res Media Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-registration-of-date-proble" class="internal xref">Registration of "date" Problem Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-registration-of-ohttp-key-p" class="internal xref">Registration of "ohttp-key" Problem Type</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-complete-example-of-a-reque" class="internal xref">Complete Example of a Request and Response</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-index" class="internal xref">Index</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">HTTP requests reveal information about client identities to servers. While the
actual content of the request message is under the control of the client, other
information that is more difficult to control can still be used to identify the
client.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">In particular, the source IP address of the underlying connection reveals
identifying information that the client has only limited control over. While
client-configured HTTP proxies can provide a degree of protection against IP
address tracking, they present an unfortunate tradeoff: if they are used without
TLS, the contents of communication are revealed to the proxy; if they are used
with TLS, a new connection needs to be used for each request to assure that the
origin server cannot use the connection as a way to correlate requests,
incurring significant performance overheads.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">To overcome these limitations, this document defines Oblivious HTTP, a protocol
for encrypting and sending HTTP messages from a client to a gateway. This uses a
trusted relay service in a manner that mitigates the use of metadata such as IP
address and connection information for client identification, with reasonable
performance characteristics.  This document describes:<a href="#section-1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-4">
<li id="section-1-4.1">
          <p id="section-1-4.1.1">an algorithm for encapsulating binary HTTP messages <span>[<a href="#BINARY" class="cite xref">BINARY</a>]</span> using Hybrid
Public Key Encryption (HPKE; <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>) to protect their contents,<a href="#section-1-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-4.2">
          <p id="section-1-4.2.1">a method for forwarding these encapsulated messages between clients and an
<span id="iref-oblivious-gateway-resource-" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> through a trusted <span id="iref-oblivious-relay-resource-2" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> using
HTTP, and<a href="#section-1-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-4.3">
          <p id="section-1-4.3.1">requirements for how the <span id="iref-oblivious-gateway-resource-3" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> handles encapsulated HTTP
messages and produces encapsulated responses for the client.<a href="#section-1-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-1-5">The combination of encapsulation and relaying ensures that <span id="iref-oblivious-gateway-resource-4" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>
never sees the client's IP address and the <span id="iref-oblivious-relay-resource-5" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> never sees
plaintext HTTP message content.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Oblivious HTTP allows connection reuse between the client and <span id="iref-oblivious-relay-resource-6" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay
Resource</a>, as well as between that relay and the <span id="iref-oblivious-gateway-resource-7" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>, so this
scheme represents a performance improvement over using just one request in each
connection.  With limited trust placed in the <span id="iref-oblivious-relay-resource-8" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> (see
<a href="#security" class="auto internal xref">Section 6</a>), <span id="iref-clients-9" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> are assured that requests are not uniquely attributed to
them or linked to other requests.<a href="#section-1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="overview">
<section id="section-2">
      <h2 id="name-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<p id="section-2-1">An Oblivious HTTP <span id="iref-client-10" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> must initially know the following:<a href="#section-2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1">
          <p id="section-2-2.1.1">The identity of an <span id="iref-oblivious-gateway-resource-1" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>.  This might include some
information about what Target Resources the <span id="iref-oblivious-gateway-resource-12" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>
supports.<a href="#section-2-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.2">
          <p id="section-2-2.2.1">The details of an HPKE public key for the <span id="iref-oblivious-gateway-resource-13" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>,
including an identifier for that key and the HPKE algorithms that are used
with that key.<a href="#section-2-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.3">
          <p id="section-2-2.3.1">The identity of an <span id="iref-oblivious-relay-resource-14" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> that will accept relay requests
carrying an <span id="iref-encapsulated-request-15" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> as its content and forward the content in
these requests to a particular <span id="iref-oblivious-gateway-resource-16" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>.  Oblivious HTTP
uses a one-to-one mapping between <span id="iref-oblivious-relay-and-gateway" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay and Gateway Resources</a>; see
<a href="#proxy-state" class="auto internal xref">Section 8.2</a> for more details.<a href="#section-2-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-3">This information allows the <span id="iref-client-18" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> to send HTTP requests to the <span id="iref-oblivious-gateway-resource-19" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> for forwarding to a <span id="iref-target-resource-20" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>.  The <span id="iref-oblivious-gateway-resource-2" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a> does not learn the client's IP address or any other identifying
information that might be revealed from the client at the transport layer, nor
does the <span id="iref-oblivious-gateway-resource-22" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> learn which of the requests it receives are
from the same <span id="iref-client-23" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>.<a href="#section-2-3" class="pilcrow">¶</a></p>
<span id="name-overview-of-oblivious-http"></span><div id="fig-overview">
<figure id="figure-1">
        <div id="section-2-4.1">
          <div class="alignLeft art-svg artwork" id="section-2-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="480" width="560" viewBox="0 0 560 480" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,48 L 8,96" fill="none" stroke="black"></path>
              <path d="M 48,96 L 48,464" fill="none" stroke="black"></path>
              <path d="M 88,48 L 88,96" fill="none" stroke="black"></path>
              <path d="M 152,48 L 152,96" fill="none" stroke="black"></path>
              <path d="M 192,96 L 192,464" fill="none" stroke="black"></path>
              <path d="M 240,48 L 240,96" fill="none" stroke="black"></path>
              <path d="M 288,48 L 288,96" fill="none" stroke="black"></path>
              <path d="M 312,48 L 312,96" fill="none" stroke="black"></path>
              <path d="M 360,96 L 360,464" fill="none" stroke="black"></path>
              <path d="M 400,48 L 400,96" fill="none" stroke="black"></path>
              <path d="M 440,48 L 440,96" fill="none" stroke="black"></path>
              <path d="M 480,96 L 480,464" fill="none" stroke="black"></path>
              <path d="M 528,48 L 528,96" fill="none" stroke="black"></path>
              <path d="M 552,48 L 552,96" fill="none" stroke="black"></path>
              <path d="M 304,32 L 536,32" fill="none" stroke="black"></path>
              <path d="M 8,48 L 88,48" fill="none" stroke="black"></path>
              <path d="M 152,48 L 240,48" fill="none" stroke="black"></path>
              <path d="M 312,48 L 400,48" fill="none" stroke="black"></path>
              <path d="M 440,48 L 528,48" fill="none" stroke="black"></path>
              <path d="M 8,96 L 88,96" fill="none" stroke="black"></path>
              <path d="M 152,96 L 240,96" fill="none" stroke="black"></path>
              <path d="M 312,96 L 400,96" fill="none" stroke="black"></path>
              <path d="M 440,96 L 528,96" fill="none" stroke="black"></path>
              <path d="M 304,112 L 352,112" fill="none" stroke="black"></path>
              <path d="M 368,112 L 472,112" fill="none" stroke="black"></path>
              <path d="M 488,112 L 536,112" fill="none" stroke="black"></path>
              <path d="M 48,192 L 184,192" fill="none" stroke="black"></path>
              <path d="M 192,256 L 352,256" fill="none" stroke="black"></path>
              <path d="M 360,272 L 472,272" fill="none" stroke="black"></path>
              <path d="M 368,320 L 480,320" fill="none" stroke="black"></path>
              <path d="M 200,384 L 360,384" fill="none" stroke="black"></path>
              <path d="M 56,448 L 192,448" fill="none" stroke="black"></path>
              <path d="M 304,32 C 295.16936,32 288,39.16936 288,48" fill="none" stroke="black"></path>
              <path d="M 536,32 C 544.83064,32 552,39.16936 552,48" fill="none" stroke="black"></path>
              <path d="M 304,112 C 295.16936,112 288,104.83064 288,96" fill="none" stroke="black"></path>
              <path d="M 536,112 C 544.83064,112 552,104.83064 552,96" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="480,272 468,266.4 468,277.6" fill="black" transform="rotate(0,472,272)"></polygon>
              <polygon class="arrowhead" points="376,320 364,314.4 364,325.6" fill="black" transform="rotate(180,368,320)"></polygon>
              <polygon class="arrowhead" points="360,256 348,250.4 348,261.6" fill="black" transform="rotate(0,352,256)"></polygon>
              <polygon class="arrowhead" points="208,384 196,378.4 196,389.6" fill="black" transform="rotate(180,200,384)"></polygon>
              <polygon class="arrowhead" points="192,192 180,186.4 180,197.6" fill="black" transform="rotate(0,184,192)"></polygon>
              <polygon class="arrowhead" points="64,448 52,442.4 52,453.6" fill="black" transform="rotate(180,56,448)"></polygon>
              <g class="text">
                <text x="44" y="68">Client</text>
                <text x="184" y="68">Relay</text>
                <text x="352" y="68">Gateway</text>
                <text x="476" y="68">Target</text>
                <text x="196" y="84">Resource</text>
                <text x="356" y="84">Resource</text>
                <text x="484" y="84">Resource</text>
                <text x="80" y="132">Relay</text>
                <text x="88" y="148">Request</text>
                <text x="68" y="164">[+</text>
                <text x="132" y="164">Encapsulated</text>
                <text x="112" y="180">Request</text>
                <text x="152" y="180">]</text>
                <text x="232" y="196">Gateway</text>
                <text x="232" y="212">Request</text>
                <text x="212" y="228">[+</text>
                <text x="276" y="228">Encapsulated</text>
                <text x="256" y="244">Request</text>
                <text x="296" y="244">]</text>
                <text x="400" y="260">Request</text>
                <text x="436" y="308">Response</text>
                <text x="320" y="324">Gateway</text>
                <text x="316" y="340">Response</text>
                <text x="236" y="356">[+</text>
                <text x="300" y="356">Encapsulated</text>
                <text x="300" y="372">Response</text>
                <text x="344" y="372">]</text>
                <text x="160" y="388">Relay</text>
                <text x="148" y="404">Response</text>
                <text x="68" y="420">[+</text>
                <text x="132" y="420">Encapsulated</text>
                <text x="132" y="436">Response</text>
                <text x="176" y="436">]</text>
              </g>
            </svg><a href="#section-2-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-overview-of-oblivious-http" class="selfRef">Overview of Oblivious HTTP</a>
        </figcaption></figure>
</div>
<p id="section-2-5">In order to forward a request for a <span id="iref-target-resource-24" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> to the <span id="iref-oblivious-gateway-resource-25" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a>, the following steps occur, as shown in <a href="#fig-overview" class="auto internal xref">Figure 1</a>:<a href="#section-2-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2-6">
<li id="section-2-6.1">
          <p id="section-2-6.1.1">The <span id="iref-client-26" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> constructs an HTTP request for a <span id="iref-target-resource-27" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>.<a href="#section-2-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-6.2">
          <p id="section-2-6.2.1">The <span id="iref-client-28" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> encodes the HTTP request in a binary HTTP message and then
encapsulates that message using HPKE and the process from <a href="#request" class="auto internal xref">Section 4.3</a>.<a href="#section-2-6.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-6.3">
          <p id="section-2-6.3.1">The <span id="iref-client-29" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> sends a POST request to the <span id="iref-oblivious-relay-resource-30" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> with the
<span id="iref-encapsulated-request-31" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> as the content of that message.<a href="#section-2-6.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-6.4">
          <p id="section-2-6.4.1">The <span id="iref-oblivious-relay-resource-32" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> forwards this request to the Oblivious Gateway
resource.<a href="#section-2-6.4.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-6.5">
          <p id="section-2-6.5.1">The <span id="iref-oblivious-gateway-resource-33" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> receives this request and removes
the HPKE protection to obtain an HTTP request.<a href="#section-2-6.5.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-2-7">The <span id="iref-oblivious-gateway-resource-34" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> then handles the HTTP request. This typically
involves making an HTTP request using the content of the <span id="iref-encapsulated-request-35" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>. Once the
<span id="iref-oblivious-gateway-resource-36" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> has an HTTP response for this request, the following
steps occur to return this response to the client:<a href="#section-2-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2-8">
<li id="section-2-8.1">
          <p id="section-2-8.1.1">The <span id="iref-oblivious-gateway-resource-37" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> encapsulates the HTTP response following the
process in <a href="#response" class="auto internal xref">Section 4.4</a> and sends this in response to the request from the
<span id="iref-oblivious-relay-resource-38" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a>.<a href="#section-2-8.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-8.2">
          <p id="section-2-8.2.1">The <span id="iref-oblivious-relay-resource-39" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> forwards this response to the <span id="iref-client-40" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>.<a href="#section-2-8.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-8.3">
          <p id="section-2-8.3.1">The <span id="iref-client-41" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> removes the encapsulation to obtain the response to the original
 request.<a href="#section-2-8.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-2-9">This interaction provides authentication and confidentiality protection between
the <span id="iref-client-42" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> and the Oblivious Gateway, but importantly not between the <span id="iref-client-43" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> and
the <span id="iref-target-resource-44" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>. While the <span id="iref-target-resource-45" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> is a distinct HTTP resource from
the <span id="iref-oblivious-gateway-resource-46" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>, they are both logically under the control of the
Oblivious Gateway, since the <span id="iref-oblivious-gateway-resource-47" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> can unilaterally dictate
the responses returned from the <span id="iref-target-resource-48" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> to the <span id="iref-client-49" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>. This arrangement
is shown in <a href="#fig-overview" class="auto internal xref">Figure 1</a>.<a href="#section-2-9" class="pilcrow">¶</a></p>
<div id="applicability">
<section id="section-2.1">
        <h3 id="name-applicability">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-applicability" class="section-name selfRef">Applicability</a>
        </h3>
<p id="section-2.1-1">Oblivious HTTP has limited applicability.  Imporantly, it requires expicit
support from a willing <span id="iref-oblivious-relay-resource-50" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> and <span id="iref-oblivious-gateway-resource-5" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>,
thereby limiting the use of Oblivious HTTP for generic applications;
see <a href="#server-responsibilities" class="auto internal xref">Section 6.3</a> for more information.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Many uses of HTTP benefit from being able to carry state between requests,
such as with cookies (<span>[<a href="#COOKIES" class="cite xref">COOKIES</a>]</span>), authentication (<span><a href="https://rfc-editor.org/rfc/rfc9110#section-11" class="relref">Section 11</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>),
or even alternative services (<span>[<a href="#RFC7838" class="cite xref">RFC7838</a>]</span>).  Oblivious HTTP removes linkage
at the transport layer, which is only useful for an application
that does not carry state between requests.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">Oblivious HTTP is primarily useful where privacy risks associated with possible
stateful treatment of requests are sufficiently large that the cost of deploying
this protocol can be justified.  Oblivious HTTP is simpler and less costly than
more robust systems, like Prio (<span>[<a href="#PRIO" class="cite xref">PRIO</a>]</span>) or Tor (<span>[<a href="#DMS2004" class="cite xref">DMS2004</a>]</span>), which can
provide stronger guarantees at higher operational costs.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">Oblivious HTTP is more costly than a direct connection to a server.  Some costs,
like those involved with connection setup, can be amortized, but there are
several ways in which Oblivious HTTP is more expensive than a direct request:<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-5.1">
            <p id="section-2.1-5.1.1">Each request requires at least two regular HTTP requests, which could
increase latency.<a href="#section-2.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-5.2">
            <p id="section-2.1-5.2.1">Each request is expanded in size with additional HTTP fields,
encryption-related metadata, and AEAD expansion.<a href="#section-2.1-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-5.3">
            <p id="section-2.1-5.3.1">Deriving cryptographic keys and applying them for request and
response protection takes non-negligible computational resources.<a href="#section-2.1-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.1-6">Examples of where preventing the linking of requests might justify these costs
include:<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-7.1">
            <p id="section-2.1-7.1.1">DNS queries.  DNS queries made to a recursive resolver reveal information
about the requester, particularly if linked to other queries.<a href="#section-2.1-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-7.2">
            <p id="section-2.1-7.2.1">Telemetry submission.  Applications that submit reports about their usage to
their developers might use Oblivious HTTP for some types of moderately
sensitive data.<a href="#section-2.1-7.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.1-8">These are examples of requests where there is information in a request that - if
it were connected to the identity of the user - might allow a server to learn
something about that user even if the identity of the user is pseudonymous.
Other examples include the submission of anonymous surveys, making search
queries, or requesting location-specific content (such as retrieving tiles of a
map display).<a href="#section-2.1-8" class="pilcrow">¶</a></p>
<p id="section-2.1-9">In addition to these limitations, <a href="#security" class="auto internal xref">Section 6</a> describes operational constraints
that are necessary to realize the goals of the protocol.<a href="#section-2.1-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2.2">
        <h3 id="name-conventions-and-definitions">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
        </h3>
<p id="section-2.2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">This document uses terminology from <span>[<a href="#HTTP" class="cite xref">HTTP</a>]</span> and defines several terms as
follows:<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.2-3">
          <dt id="section-2.2-3.1">
<span id="iref-client-52" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-3.2">
            <div id="dfn-client">
<p id="section-2.2-3.2.1">A <span id="iref-client-53" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> originates Oblivious HTTP requests.  A <span id="iref-client-54" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> is also an HTTP client
in two ways: for the <span id="iref-target-resource-55" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> and for the <span id="iref-oblivious-relay-resource-56" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay
Resource</a>. However, when referring to the HTTP definition of client (<span><a href="https://rfc-editor.org/rfc/rfc9110#section-3.3" class="relref">Section 3.3</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>), the term "HTTP client" is used; see <a href="#http-usage" class="auto internal xref">Section 5</a>.<a href="#section-2.2-3.2.1" class="pilcrow">¶</a></p>
</div>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.3">
<span id="iref-encapsulated-request-57" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-3.4">
            <div id="dfn-enc-req">
<p id="section-2.2-3.4.1">An HTTP request that is encapsulated in an HPKE-encrypted message; see
<a href="#request" class="auto internal xref">Section 4.3</a>.<a href="#section-2.2-3.4.1" class="pilcrow">¶</a></p>
</div>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.5">
<span id="iref-encapsulated-response-58" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-3.6">
            <div id="dfn-enc-res">
<p id="section-2.2-3.6.1">An HTTP response that is encapsulated in an HPKE-encrypted message; see
<a href="#response" class="auto internal xref">Section 4.4</a>.<a href="#section-2.2-3.6.1" class="pilcrow">¶</a></p>
</div>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.7">
<span id="iref-oblivious-relay-resource-59" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a>:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-3.8">
            <div id="dfn-relay">
<p id="section-2.2-3.8.1">An intermediary that forwards Encapsulated Requests and Responses between
<span id="iref-clients-60" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> and a single <span id="iref-oblivious-gateway-resource-6" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>.  In context, this can be
referred to as simply a "relay".<a href="#section-2.2-3.8.1" class="pilcrow">¶</a></p>
</div>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.9">
<span id="iref-oblivious-gateway-resource-62" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-3.10">
            <div id="dfn-gateway">
<p id="section-2.2-3.10.1">A resource that can receive an <span id="iref-encapsulated-request-63" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>, extract the contents of
that request, forward it to a <span id="iref-target-resource-64" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>, receive a response, encapsulate
that response, then return the resulting <span id="iref-encapsulated-response-65" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>.  In context,
this can be referred to as simply a "gateway".<a href="#section-2.2-3.10.1" class="pilcrow">¶</a></p>
</div>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.11">
<span id="iref-target-resource-66" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-3.12">
            <div id="dfn-target">
<p id="section-2.2-3.12.1">The resource that is the target of an <span id="iref-encapsulated-request-67" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>.  This resource
logically handles only regular HTTP requests and responses and so might be
ignorant of the use of Oblivious HTTP to reach it.<a href="#section-2.2-3.12.1" class="pilcrow">¶</a></p>
</div>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.2-4">This document includes pseudocode that uses the functions and conventions
defined in <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">Encoding an integer to a sequence of bytes in network byte order is described
using the function <code>encode(n, v)</code>, where <code>n</code> is the number of bytes and <code>v</code> is
the integer value.  ASCII <span>[<a href="#ASCII" class="cite xref">ASCII</a>]</span> encoding of a string <code>s</code> is
indicated using the function <code>encode_str(s)</code>.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2-6">Formats are described using notation from <span><a href="https://rfc-editor.org/rfc/rfc9000#section-1.3" class="relref">Section 1.3</a> of [<a href="#QUIC" class="cite xref">QUIC</a>]</span>.  An extension
to that notation expresses the number of bits in a field using a simple
mathematical function.<a href="#section-2.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="key-configuration">
<section id="section-3">
      <h2 id="name-key-configuration">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-key-configuration" class="section-name selfRef">Key Configuration</a>
      </h2>
<p id="section-3-1">A <span id="iref-client-68" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> needs to acquire information about the <span id="iref-key-configuration-69" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> of the
<span id="iref-oblivious-gateway-resource-70" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> in order to send Encapsulated Requests.
In order to ensure that <span id="iref-clients-71" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> do not encapsulate messages that other entities
can intercept, the <span id="iref-key-configuration-72" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> <span class="bcp14">MUST</span> be authenticated and have integrity
protection.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">This document does not define how that acquisition occurs. However, in
order to help facilitate interoperability, it does specify a format
for the keys. This ensures that different
<span id="iref-client-73" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> implementations can be configured in the same way and also
enables advertising <span id="iref-key-configurations-74" class="iref"></span><a href="#key-configuration" class="internal xref">key configurations</a> in a consistent format.  This
format might be used, for example with HTTPS, as part of a system for
configuring or discovering <span id="iref-key-configurations-75" class="iref"></span><a href="#key-configuration" class="internal xref">key configurations</a>.  Note however that such
a system needs to consider the potential for <span id="iref-key-configuration-76" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> to be
used to compromise <span id="iref-client-77" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> privacy; see <a href="#privacy" class="auto internal xref">Section 7</a>.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">A <span id="iref-client-78" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> might have multiple <span id="iref-key-configurations-79" class="iref"></span><a href="#key-configuration" class="internal xref">key configurations</a> to select from when
encapsulating a request. <span id="iref-clients-80" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> are responsible for selecting a preferred <span id="iref-key-configuration-81" class="iref"></span><a href="#key-configuration" class="internal xref">key
configuration</a> from those it supports. <span id="iref-clients-82" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> need to consider both the key
encapsulation method (KEM) and the combinations of key derivation function
(KDF) and authenticated encryption with associated data (AEAD) in this
decision.<a href="#section-3-3" class="pilcrow">¶</a></p>
<div id="key-config">
<section id="section-3.1">
        <h3 id="name-key-configuration-encoding">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-key-configuration-encoding" class="section-name selfRef">Key Configuration Encoding</a>
        </h3>
<p id="section-3.1-1">A single <span id="iref-key-configuration-83" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> consists of a key identifier, a public key, an
identifier for the KEM that the public key uses, and a set of HPKE symmetric
algorithms. Each symmetric algorithm consists of an identifier for a KDF and an
identifier for an AEAD.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2"><a href="#format-key-config" class="auto internal xref">Figure 2</a> shows a single <span id="iref-key-configuration-84" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a>.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<span id="name-a-single-key-configuration"></span><div id="format-key-config">
<figure id="figure-2">
          <div class="lang-tls-syntax sourcecode" id="section-3.1-3.1">
<pre>
HPKE Symmetric Algorithms {
  HPKE KDF ID (16),
  HPKE AEAD ID (16),
}

Key Config {
  Key Identifier (8),
  HPKE KEM ID (16),
  HPKE Public Key (Npk * 8),
  HPKE Symmetric Algorithms Length (16) = 4..65532,
  HPKE Symmetric Algorithms (32) ...,
}
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-a-single-key-configuration" class="selfRef">A Single Key Configuration</a>
          </figcaption></figure>
</div>
<p id="section-3.1-4">That is, a <span id="iref-key-configuration-85" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> consists of the following fields:<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.1-5">
          <dt id="section-3.1-5.1">Key Identifier:</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-5.2">
            <p id="section-3.1-5.2.1">An 8 bit value that identifies the key used by the <span id="iref-oblivious-gateway-resource-8" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>.<a href="#section-3.1-5.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-5.3">HPKE KEM ID:</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-5.4">
            <p id="section-3.1-5.4.1">A 16 bit value that identifies the Key Encapsulation Method (KEM) used for the
identified key as defined in <span><a href="https://rfc-editor.org/rfc/rfc9180#section-7.1" class="relref">Section 7.1</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span> or <a href="https://www.iana.org/assignments/hpke/hpke.xhtml#hpke-kem-ids">the HPKE KDF IANA
registry</a>.<a href="#section-3.1-5.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-5.5">HPKE Public Key:</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-5.6">
            <p id="section-3.1-5.6.1">The public key used by the gateway. The length of the public key is <code>Npk</code>, which is
determined by the choice of HPKE KEM as defined in <span><a href="https://rfc-editor.org/rfc/rfc9180#section-4" class="relref">Section 4</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span>.<a href="#section-3.1-5.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-5.7">HPKE Symmetric Algorithms Length:</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-5.8">
            <p id="section-3.1-5.8.1">A 16 bit integer in network byte order that encodes the length, in bytes, of
the HPKE Symmetric Algorithms field that follows.<a href="#section-3.1-5.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-5.9">HPKE Symmetric Algorithms:</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-5.10">
            <p id="section-3.1-5.10.1">One or more pairs of identifiers for the different combinations of HPKE KDF
and AEAD that the <span id="iref-oblivious-gateway-resource-87" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> supports:<a href="#section-3.1-5.10.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.1-5.10.2">
              <dt id="section-3.1-5.10.2.1">HPKE KDF ID:</dt>
              <dd style="margin-left: 1.5em" id="section-3.1-5.10.2.2">
                <p id="section-3.1-5.10.2.2.1">A 16 bit HPKE KDF identifier as defined in <span><a href="https://rfc-editor.org/rfc/rfc9180#section-7.2" class="relref">Section 7.2</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span> or <a href="https://www.iana.org/assignments/hpke/hpke.xhtml#hpke-kdf-ids">the
HPKE KDF IANA
registry</a>.<a href="#section-3.1-5.10.2.2.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
<dt id="section-3.1-5.10.2.3">HPKE AEAD ID:</dt>
              <dd style="margin-left: 1.5em" id="section-3.1-5.10.2.4">
                <p id="section-3.1-5.10.2.4.1">A 16 bit HPKE AEAD identifier as defined in <span><a href="https://rfc-editor.org/rfc/rfc9180#section-7.3" class="relref">Section 7.3</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span> or <a href="https://www.iana.org/assignments/hpke/hpke.xhtml#hpke-aead-ids">the
HPKE AEAD IANA
registry</a>.<a href="#section-3.1-5.10.2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="ohttp-keys">
<section id="section-3.2">
        <h3 id="name-key-configuration-media-typ">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-key-configuration-media-typ" class="section-name selfRef">Key Configuration Media Type</a>
        </h3>
<p id="section-3.2-1">The "application/ohttp-keys" format is a media type that identifies a serialized
collection of <span id="iref-key-configurations-88" class="iref"></span><a href="#key-configuration" class="internal xref">key configurations</a>. The content of this media type comprises one
or more <span id="iref-key-configuration-89" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> encodings (see <a href="#key-config" class="auto internal xref">Section 3.1</a>).  Each encoded
configuration is prefixed with a two byte integer in network byte order that
indicates the length of the <span id="iref-key-configuration-90" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> in bytes.  The length-prefixed
encodings are concatenated to form a list.  See <a href="#iana-keys" class="auto internal xref">Section 9.1</a> for a definition
of the media type.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">Evolution of the <span id="iref-key-configuration-91" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> format is supported through the definition of
new formats that are identified by new media types.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">A <span id="iref-client-92" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> that receives an "application/ohttp-keys" object with encoding errors
might be able to recover one or more <span id="iref-key-configurations-93" class="iref"></span><a href="#key-configuration" class="internal xref">key configurations</a>.  Differences in how <span id="iref-key-configurations-94" class="iref"></span><a href="#key-configuration" class="internal xref">key
configurations</a> are recovered might be exploited to segregate <span id="iref-clients-95" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>, so <span id="iref-clients-96" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>
          <span class="bcp14">MUST</span> discard incorrectly encoded <span id="iref-key-configuration-97" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> collections.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="hpke-encapsulation">
<section id="section-4">
      <h2 id="name-hpke-encapsulation">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-hpke-encapsulation" class="section-name selfRef">HPKE Encapsulation</a>
      </h2>
<p id="section-4-1">This document defines how a binary-encoded HTTP message <span>[<a href="#BINARY" class="cite xref">BINARY</a>]</span> is
encapsulated using HPKE <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>.  Separate media types are defined to
distinguish request and response messages:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">
          <p id="section-4-2.1.1">An <span id="iref-encapsulated-request-98" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> format defined in <a href="#req-format" class="auto internal xref">Section 4.1</a> is identified by the
<span><a href="#iana-req" class="internal xref">"<code>message/ohttp-req</code>" media type</a> (<a href="#iana-req" class="internal xref">message/ohttp-req Media Type</a>)</span>.<a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-2.2">
          <p id="section-4-2.2.1">An <span id="iref-encapsulated-response-99" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a> format defined in <a href="#res-format" class="auto internal xref">Section 4.2</a> is identified by the
<span><a href="#iana-res" class="internal xref">"<code>message/ohttp-res</code>" media type</a> (<a href="#iana-res" class="auto internal xref">Section 9.3</a>)</span>.<a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-3">Alternative encapsulations or message formats are indicated using the media
type; see <a href="#req-res-media" class="auto internal xref">Section 4.5</a> and <a href="#repurposing" class="auto internal xref">Section 4.6</a>.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="req-format">
<section id="section-4.1">
        <h3 id="name-request-format">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-request-format" class="section-name selfRef">Request Format</a>
        </h3>
<p id="section-4.1-1">A message in "<code>message/ohttp-req</code>" format protects a binary HTTP request
message; see <a href="#fig-req-pt" class="auto internal xref">Figure 3</a>.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<span id="name-plaintext-request-content"></span><div id="fig-req-pt">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-4.1-2.1">
<pre>
Request {
  Binary HTTP Message (..),
}
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-plaintext-request-content" class="selfRef">Plaintext Request Content</a>
          </figcaption></figure>
</div>
<p id="section-4.1-3">This plaintext Request is encapsulated into a message in "<code>message/ohttp-req</code>"
form by generating an <span id="iref-encapsulated-request-100" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>.  An <span id="iref-encapsulated-request-101" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> comprises a
key identifier; HPKE parameters for the chosen KEM, KDF, and AEAD; the
encapsulated KEM shared secret (or <code>enc</code>); and an HPKE-protected binary HTTP
request message.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">An <span id="iref-encapsulated-request-102" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> is shown in <a href="#fig-enc-request" class="auto internal xref">Figure 4</a>. <a href="#request" class="auto internal xref">Section 4.3</a> describes
the process for constructing and processing an <span id="iref-encapsulated-request-103" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<span id="name-encapsulated-request"></span><div id="fig-enc-request">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.1-5.1">
<pre>
Encapsulated Request {
  Key Identifier (8),
  HPKE KEM ID (16),
  HPKE KDF ID (16),
  HPKE AEAD ID (16),
  Encapsulated KEM Shared Secret (8 * Nenc),
  HPKE-Protected Request (..),
}
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-encapsulated-request" class="selfRef">Encapsulated Request</a>
          </figcaption></figure>
</div>
<p id="section-4.1-6">That is, an <span id="iref-encapsulated-request-104" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> comprises a Key Identifier, HPKE KEM ID, HPKE
KDF ID, HPKE AEAD ID, Encapsulated KEM Shared Secret, and HPKE-Protected
Request.  The Key Identifier, HPKE KEM ID, HPKE KDF ID, and HPKE AEAD ID fields
are defined in <a href="#key-config" class="auto internal xref">Section 3.1</a>.  The Encapsulated KEM Shared Secret is the output
of the <code>Encap()</code> function for the KEM, which is <code>Nenc</code> bytes in length, as
defined in <span><a href="https://rfc-editor.org/rfc/rfc9180#section-4" class="relref">Section 4</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span>.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="res-format">
<section id="section-4.2">
        <h3 id="name-response-format">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-response-format" class="section-name selfRef">Response Format</a>
        </h3>
<p id="section-4.2-1">A message in "<code>message/ohttp-res</code>" format protects a binary HTTP response
message; see <a href="#fig-res-pt" class="auto internal xref">Figure 5</a>.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<span id="name-plaintext-response-content"></span><div id="fig-res-pt">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-4.2-2.1">
<pre>
Response {
  Binary HTTP Message (..),
}
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-plaintext-response-content" class="selfRef">Plaintext Response Content</a>
          </figcaption></figure>
</div>
<p id="section-4.2-3">This plaintext Response is encapsulated into a message in "<code>message/ohttp-res</code>"
form by generating an <span id="iref-encapsulated-response-105" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>.  An <span id="iref-encapsulated-response-106" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a> comprises
a nonce and the AEAD-protected binary HTTP response message.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">An <span id="iref-encapsulated-response-107" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a> is shown in <a href="#fig-enc-response" class="auto internal xref">Figure 6</a>. <a href="#response" class="auto internal xref">Section 4.4</a> describes
the process for constructing and processing an <span id="iref-encapsulated-response-108" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<span id="name-encapsulated-response"></span><div id="fig-enc-response">
<figure id="figure-6">
          <div class="alignLeft art-text artwork" id="section-4.2-5.1">
<pre>
Encapsulated Response {
  Nonce (8 * max(Nn, Nk)),
  AEAD-Protected Response (..),
}
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-encapsulated-response" class="selfRef">Encapsulated Response</a>
          </figcaption></figure>
</div>
<p id="section-4.2-6">That is, an <span id="iref-encapsulated-response-109" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a> contains a Nonce and an AEAD-Protected
Response.  The Nonce field is either <code>Nn</code> or <code>Nk</code> bytes long, whichever is
larger.  The <code>Nn</code> and <code>Nk</code> values correspond to parameters of the AEAD used in
HPKE, which is defined in <span><a href="https://rfc-editor.org/rfc/rfc9180#section-7.3" class="relref">Section 7.3</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span> or <a href="https://www.iana.org/assignments/hpke/hpke.xhtml#hpke-aead-ids">the HPKE AEAD IANA
registry</a>.  <code>Nn</code>
and <code>Nk</code> refer to the size of the AEAD nonce and key respectively, in bytes.<a href="#section-4.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request">
<section id="section-4.3">
        <h3 id="name-encapsulation-of-requests">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-encapsulation-of-requests" class="section-name selfRef">Encapsulation of Requests</a>
        </h3>
<p id="section-4.3-1"><span id="iref-clients-110" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> encapsulate a request, <code>request</code>, using values from a <span id="iref-key-configuration-111" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a>:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-2.1">
            <p id="section-4.3-2.1.1">the key identifier from the configuration, <code>key_id</code>, with the corresponding KEM
identified by <code>kem_id</code>,<a href="#section-4.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.2">
            <p id="section-4.3-2.2.1">the public key from the configuration, <code>pkR</code>, and<a href="#section-4.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.3">
            <p id="section-4.3-2.3.1">a combination of KDF, identified by <code>kdf_id</code>, and AEAD, identified by
<code>aead_id</code>, that the <span id="iref-client-112" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> selects from those in the <span id="iref-key-configuration-113" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a>.<a href="#section-4.3-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-3">The <span id="iref-client-114" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> then constructs an <span id="iref-encapsulated-request-115" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>, <code>enc_request</code>, from a binary
encoded HTTP request <span>[<a href="#BINARY" class="cite xref">BINARY</a>]</span>, <code>request</code>, as follows:<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3-4">
<li id="section-4.3-4.1">
            <p id="section-4.3-4.1.1">Construct a message header, <code>hdr</code>, by concatenating the values of <code>key_id</code>,
<code>kem_id</code>, <code>kdf_id</code>, and <code>aead_id</code>, as one 8-bit integer and three 16-bit
integers, respectively, each in network byte order.<a href="#section-4.3-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.3-4.2">
            <p id="section-4.3-4.2.1">Build <code>info</code> by concatenating the ASCII-encoded string "message/bhttp
request", a zero byte, and the header.  Note: <a href="#repurposing" class="auto internal xref">Section 4.6</a> discusses how
alternative message formats might use a different <code>info</code> value.<a href="#section-4.3-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.3-4.3">
            <p id="section-4.3-4.3.1">Create a sending HPKE context by invoking <code>SetupBaseS()</code> (<span><a href="https://rfc-editor.org/rfc/rfc9180#section-5.1.1" class="relref">Section 5.1.1</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span>) with the public key of the receiver <code>pkR</code> and <code>info</code>.  This yields
the context <code>sctxt</code> and an encapsulation key <code>enc</code>.<a href="#section-4.3-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.3-4.4">
            <p id="section-4.3-4.4.1">Encrypt <code>request</code> by invoking the <code>Seal()</code> method on <code>sctxt</code> (<span><a href="https://rfc-editor.org/rfc/rfc9180#section-5.2" class="relref">Section 5.2</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span>) with empty associated data <code>aad</code>, yielding ciphertext <code>ct</code>.<a href="#section-4.3-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.3-4.5">
            <p id="section-4.3-4.5.1">Concatenate the values of <code>hdr</code>, <code>enc</code>, and <code>ct</code>, yielding an Encrypted
Request <code>enc_request</code>.<a href="#section-4.3-4.5.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.3-5">Note that <code>enc</code> is of fixed-length, so there is no ambiguity in parsing this
structure.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6">In pseudocode, this procedure is as follows:<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-7">
<pre>
hdr = concat(encode(1, key_id),
             encode(2, kem_id),
             encode(2, kdf_id),
             encode(2, aead_id))
info = concat(encode_str("message/bhttp request"),
              encode(1, 0),
              hdr)
enc, sctxt = SetupBaseS(pkR, info)
ct = sctxt.Seal("", request)
enc_request = concat(hdr, enc, ct)
</pre><a href="#section-4.3-7" class="pilcrow">¶</a>
</div>
<p id="section-4.3-8">An <span id="iref-oblivious-gateway-resource-11" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> decrypts an <span id="iref-encapsulated-request-117" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> by reversing this
process. To decapsulate an <span id="iref-encapsulated-request-118" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>, <code>enc_request</code>:<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3-9">
<li id="section-4.3-9.1">
            <p id="section-4.3-9.1.1">Parses <code>enc_request</code> into <code>key_id</code>, <code>kem_id</code>, <code>kdf_id</code>, <code>aead_id</code>, <code>enc</code>, and
<code>ct</code> (indicated using the function <code>parse()</code> in pseudocode). The <span id="iref-oblivious-gateway-resource-119" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> is then able to find the HPKE private key, <code>skR</code>,
corresponding to <code>key_id</code>.<a href="#section-4.3-9.1.1" class="pilcrow">¶</a></p>
<p id="section-4.3-9.1.2">
a. If <code>key_id</code> does not identify a key matching the type of <code>kem_id</code>, the
   <span id="iref-oblivious-gateway-resource-120" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> returns an error.<a href="#section-4.3-9.1.2" class="pilcrow">¶</a></p>
<p id="section-4.3-9.1.3">
b. If <code>kdf_id</code> and <code>aead_id</code> identify a combination of KDF and AEAD that the
   <span id="iref-oblivious-gateway-resource-121" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> is unwilling to use with <code>skR</code>, the <span id="iref-oblivious-gateway-resource-122" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
   Gateway Resource</a> returns an error.<a href="#section-4.3-9.1.3" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.3-9.2">
            <p id="section-4.3-9.2.1">Build <code>info</code> by concatenating the ASCII-encoded string "message/bhttp
request", a zero byte, <code>key_id</code> as an 8-bit integer, plus <code>kem_id</code>, <code>kdf_id</code>,
and <code>aead_id</code> as three 16-bit integers.<a href="#section-4.3-9.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.3-9.3">
            <p id="section-4.3-9.3.1">Create a receiving HPKE context, <code>rctxt</code>, by invoking <code>SetupBaseR()</code>
(<span><a href="https://rfc-editor.org/rfc/rfc9180#section-5.1.1" class="relref">Section 5.1.1</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span>) with <code>skR</code>, <code>enc</code>, and <code>info</code>.<a href="#section-4.3-9.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.3-9.4">
            <p id="section-4.3-9.4.1">Decrypt <code>ct</code> by invoking the <code>Open()</code> method on <code>rctxt</code> (<span><a href="https://rfc-editor.org/rfc/rfc9180#section-5.2" class="relref">Section 5.2</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span>), with an empty associated data <code>aad</code>, yielding <code>request</code> or an error
on failure. If decryption fails, the <span id="iref-oblivious-gateway-resource-123" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> returns an
error.<a href="#section-4.3-9.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.3-10">In pseudocode, this procedure is as follows:<a href="#section-4.3-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-11">
<pre>
key_id, kem_id, kdf_id, aead_id, enc, ct = parse(enc_request)
info = concat(encode_str("message/bhttp request"),
              encode(1, 0),
              encode(1, key_id),
              encode(2, kem_id),
              encode(2, kdf_id),
              encode(2, aead_id))
rctxt = SetupBaseR(enc, skR, info)
request, error = rctxt.Open("", ct)
</pre><a href="#section-4.3-11" class="pilcrow">¶</a>
</div>
<p id="section-4.3-12">The <span id="iref-oblivious-gateway-resource-124" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> retains the HPKE context, <code>rctxt</code>, so that it can
encapsulate a response.<a href="#section-4.3-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="response">
<section id="section-4.4">
        <h3 id="name-encapsulation-of-responses">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-encapsulation-of-responses" class="section-name selfRef">Encapsulation of Responses</a>
        </h3>
<p id="section-4.4-1"><span id="iref-oblivious-gateway-resources" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a> generate an <span id="iref-encapsulated-response-126" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>, <code>enc_response</code>,
from a binary encoded HTTP response <span>[<a href="#BINARY" class="cite xref">BINARY</a>]</span>, <code>response</code>.  The <span id="iref-oblivious-gateway-resource-127" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> uses the HPKE receiver context, <code>rctxt</code>, as the HPKE context,
<code>context</code>, as follows:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4-2">
<li id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">Export a secret, <code>secret</code>, from <code>context</code>, using the string "message/bhttp
response" as the <code>exporter_context</code> parameter to <code>context.Export</code>; see
<span><a href="https://rfc-editor.org/rfc/rfc9180#section-5.3" class="relref">Section 5.3</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span>.  The length of this secret is <code>max(Nn, Nk)</code>, where
<code>Nn</code> and <code>Nk</code> are the length of AEAD key and nonce associated with <code>context</code>.
Note: <a href="#repurposing" class="auto internal xref">Section 4.6</a> discusses how alternative message formats might use a
different <code>context</code> value.<a href="#section-4.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-2.2">
            <p id="section-4.4-2.2.1">Generate a random value of length <code>max(Nn, Nk)</code> bytes, called
<code>response_nonce</code>.<a href="#section-4.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-2.3">
            <p id="section-4.4-2.3.1">Extract a pseudorandom key, <code>prk</code>, using the <code>Extract</code> function provided by
the KDF algorithm associated with <code>context</code>. The <code>ikm</code> input to this
function is <code>secret</code>; the <code>salt</code> input is the concatenation of <code>enc</code> (from
<code>enc_request</code>) and <code>response_nonce</code>.<a href="#section-4.4-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-2.4">
            <p id="section-4.4-2.4.1">Use the <code>Expand</code> function provided by the same KDF to create an AEAD key,
<code>key</code>, of length <code>Nk</code> - the length of the keys used by the AEAD associated
with <code>context</code>. Generating <code>aead_key</code> uses a label of "key".<a href="#section-4.4-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-2.5">
            <p id="section-4.4-2.5.1">Use the same <code>Expand</code> function to create a nonce, <code>nonce</code>, of length <code>Nn</code> -
the length of the nonce used by the AEAD. Generating <code>aead_nonce</code> uses a
label of "nonce".<a href="#section-4.4-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-2.6">
            <p id="section-4.4-2.6.1">Encrypt <code>response</code>, passing the AEAD function Seal the values of <code>aead_key</code>,
<code>aead_nonce</code>, an empty <code>aad</code>, and a <code>pt</code> input of <code>response</code>, which yields <code>ct</code>.<a href="#section-4.4-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.4-2.7">
            <p id="section-4.4-2.7.1">Concatenate <code>response_nonce</code> and <code>ct</code>, yielding an <span id="iref-encapsulated-response-128" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>,
<code>enc_response</code>. Note that <code>response_nonce</code> is of fixed-length, so there is no
ambiguity in parsing either <code>response_nonce</code> or <code>ct</code>.<a href="#section-4.4-2.7.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.4-3">In pseudocode, this procedure is as follows:<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-4">
<pre>
secret = context.Export("message/bhttp response", max(Nn, Nk))
response_nonce = random(max(Nn, Nk))
salt = concat(enc, response_nonce)
prk = Extract(salt, secret)
aead_key = Expand(prk, "key", Nk)
aead_nonce = Expand(prk, "nonce", Nn)
ct = Seal(aead_key, aead_nonce, "", response)
enc_response = concat(response_nonce, ct)
</pre><a href="#section-4.4-4" class="pilcrow">¶</a>
</div>
<p id="section-4.4-5"><span id="iref-clients-129" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> decrypt an <span id="iref-encapsulated-response-130" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a> by reversing this process.  That is,
<span id="iref-clients-131" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> first parse <code>enc_response</code> into <code>response_nonce</code> and <code>ct</code>. They then
follow the same process to derive values for <code>aead_key</code> and <code>aead_nonce</code>, using
their sending HPKE context, <code>sctxt</code>, as the HPKE context, <code>context</code>.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
<p id="section-4.4-6">The <span id="iref-client-132" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> uses these values to decrypt <code>ct</code> using the Open function provided by
the AEAD. Decrypting might produce an error, as follows:<a href="#section-4.4-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-7">
<pre>
response, error = Open(aead_key, aead_nonce, "", ct)
</pre><a href="#section-4.4-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="req-res-media">
<section id="section-4.5">
        <h3 id="name-request-and-response-media-">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-request-and-response-media-" class="section-name selfRef">Request and Response Media Types</a>
        </h3>
<p id="section-4.5-1">Media types are used to identify Encapsulated Requests and Responses; see
<a href="#iana-req" class="auto internal xref">Section 9.2</a> and <a href="#iana-res" class="auto internal xref">Section 9.3</a> for definitions of these media types.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">Evolution of the format of Encapsulated Requests and Responses is supported
through the definition of new formats that are identified by new media types.
New media types might be defined to use similar encapsulation with a different
HTTP message format than in <span>[<a href="#BINARY" class="cite xref">BINARY</a>]</span>; see <a href="#repurposing" class="auto internal xref">Section 4.6</a> for guidance on
reusing this encapsulation.  Alternatively, a new encapsulation method might be
defined.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="repurposing">
<section id="section-4.6">
        <h3 id="name-repurposing-the-encapsulati">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-repurposing-the-encapsulati" class="section-name selfRef">Repurposing the Encapsulation Format</a>
        </h3>
<p id="section-4.6-1">The encrypted payload of an Oblivious HTTP request and response is a binary HTTP message
<span>[<a href="#BINARY" class="cite xref">BINARY</a>]</span>.  The <span id="iref-client-133" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> and <span id="iref-oblivious-gateway-resource-134" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> agree on this encrypted
payload type by specifying the media type "message/bhttp" in the HPKE info
string and HPKE export context string for request and response encryption,
respectively.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<p id="section-4.6-2">Future specifications may repurpose the encapsulation mechanism described in
this document.  This requires that the specification define a new media type.
The encapsulation process for that content type can follow the same process,
using new constant strings for the HPKE info and exporter context inputs.<a href="#section-4.6-2" class="pilcrow">¶</a></p>
<p id="section-4.6-3">For example, a future specification might encapsulate DNS messages, which use
the "application/dns-message" media type <span>[<a href="#RFC8484" class="cite xref">RFC8484</a>]</span>.  In creating a new,
encrypted media types, specifications might define the use of string
"application/dns-message request" (plus a zero byte and the header for the full
value) for request encryption and the string "application/dns-message response"
for response encryption.<a href="#section-4.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="http-usage">
<section id="section-5">
      <h2 id="name-http-usage">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-http-usage" class="section-name selfRef">HTTP Usage</a>
      </h2>
<p id="section-5-1">A <span id="iref-client-135" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> interacts with the <span id="iref-oblivious-relay-resource-13" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> by constructing an
<span id="iref-encapsulated-request-137" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>.  This <span id="iref-encapsulated-request-138" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> is included as the content of a
POST request to the <span id="iref-oblivious-relay-resource-139" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a>.  This request only needs those
fields necessary to carry the <span id="iref-encapsulated-request-140" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>: a method of POST, a target
URI of the <span id="iref-oblivious-relay-resource-141" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a>, a header field containing the content type
(see <a href="#iana-req" class="auto internal xref">Section 9.2</a>), and the <span id="iref-encapsulated-request-142" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> as the request content. In the
request to the <span id="iref-oblivious-relay-resource-143" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a>, <span id="iref-clients-144" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> <span class="bcp14">MAY</span> include additional
fields. However, additional fields <span class="bcp14">MUST</span> be independent of the <span id="iref-encapsulated-request-145" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated
Request</a> and <span class="bcp14">MUST</span> be fields that the <span id="iref-oblivious-relay-resource-146" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> will remove before
forwarding the <span id="iref-encapsulated-request-147" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> towards the target, such as the Connection
or Proxy-Authorization header fields <span>[<a href="#HTTP" class="cite xref">HTTP</a>]</span>.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The <span id="iref-client-148" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> role in this protocol acts as an HTTP client both with respect to the
<span id="iref-oblivious-relay-resource-149" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> and the <span id="iref-target-resource-150" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>.  For the request, the <span id="iref-clients-151" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>
makes to the <span id="iref-target-resource-152" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>, this diverges from typical HTTP assumptions about
the use of a connection (see <span><a href="https://rfc-editor.org/rfc/rfc9110#section-3.3" class="relref">Section 3.3</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>) in that the request and
response are encrypted rather than sent over a connection.  The <span id="iref-oblivious-relay-resource-15" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay
Resource</a> and the <span id="iref-oblivious-gateway-resource-15" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> also act as HTTP clients toward the
<span id="iref-oblivious-gateway-resource-155" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> and <span id="iref-target-resource-156" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> respectively.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">In order to achieve the privacy and security goals of the protocol a <span id="iref-client-157" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> also
needs to observe the guidance in <a href="#sec-client" class="auto internal xref">Section 6.1</a>.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">The <span id="iref-oblivious-relay-resource-158" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> interacts with the <span id="iref-oblivious-gateway-resource-159" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> as an
HTTP client by constructing a request using the same restrictions as the <span id="iref-client-160" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>
request, except that the target URI is the <span id="iref-oblivious-gateway-resource-161" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>.  The
content of this request is copied from the <span id="iref-client-162" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>.  An <span id="iref-oblivious-relay-resource-16" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> <span class="bcp14">MAY</span> reject
requests that are obviously invalid, such as a request with no content. The <span id="iref-oblivious-relay-resource-164" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay
Resource</a> <span class="bcp14">MUST NOT</span> add information to the request without the <span id="iref-client-165" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> being aware of
the type of information that might be added; see <a href="#relay-responsibilities" class="auto internal xref">Section 6.2</a> for
more information on relay responsibilities.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">When a response is received from the <span id="iref-oblivious-gateway-resource-166" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>, the <span id="iref-oblivious-relay-resource-167" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious
Relay Resource</a> forwards the response according to the rules of an HTTP proxy;
see <span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.6" class="relref">Section 7.6</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>.  In case of timeout or error, the <span id="iref-oblivious-relay-resource-168" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay
Resource</a> can generate a response with an appropriate status code.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">In order to achieve the privacy and security goals of the protocol an <span id="iref-oblivious-relay-resource-169" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious
Relay Resource</a> also needs to observe the guidance in
<a href="#relay-responsibilities" class="auto internal xref">Section 6.2</a>.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">An <span id="iref-oblivious-gateway-resource-17" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> acts as a gateway for requests to the <span id="iref-target-resource-171" class="iref"></span><a href="#dfn-target" class="internal xref">Target
Resource</a> (see <span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.6" class="relref">Section 7.6</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>).  The one exception is that any
information it might forward in a response <span class="bcp14">MUST</span> be encapsulated, unless it is
responding to errors that do not relate to processing the contents of the
encapsulated request; see <a href="#errors" class="auto internal xref">Section 5.2</a>.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">An <span id="iref-oblivious-gateway-resource-172" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>, if it receives any response from the <span id="iref-target-resource-173" class="iref"></span><a href="#dfn-target" class="internal xref">Target
Resource</a>, sends a single 200 response containing the encapsulated response.
Like the request from the <span id="iref-client-174" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>, this response <span class="bcp14">MUST</span> only contain those fields
necessary to carry the encapsulated response: a 200 status code, a header field
indicating the content type, and the encapsulated response as the response
content.  As with requests, additional fields <span class="bcp14">MAY</span> be used to convey information
that does not reveal information about the encapsulated response.<a href="#section-5-8" class="pilcrow">¶</a></p>
<p id="section-5-9">An <span id="iref-oblivious-gateway-resource-175" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> that does not receive a response can itself
generate a response with an appropriate error status code (such as 504 (Gateway
Timeout); see <span><a href="https://rfc-editor.org/rfc/rfc9110#section-15.6.5" class="relref">Section 15.6.5</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>), which is then encapsulated in the
same way as a successful response.<a href="#section-5-9" class="pilcrow">¶</a></p>
<p id="section-5-10">In order to achieve the privacy and security goals of the protocol an <span id="iref-oblivious-gateway-resource-176" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> also needs to observe the guidance in
<a href="#server-responsibilities" class="auto internal xref">Section 6.3</a>.<a href="#section-5-10" class="pilcrow">¶</a></p>
<div id="informational-responses">
<section id="section-5.1">
        <h3 id="name-informational-responses">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-informational-responses" class="section-name selfRef">Informational Responses</a>
        </h3>
<p id="section-5.1-1">This encapsulation does not permit progressive processing of responses.  Though
the binary HTTP response format does support the inclusion of informational
(1xx) status codes, the AEAD encapsulation cannot be removed until the entire
message is received.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">In particular, the Expect header field with 100-continue (see <span><a href="https://rfc-editor.org/rfc/rfc9110#section-10.1.1" class="relref">Section 10.1.1</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>) cannot be used.  <span id="iref-clients-177" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> <span class="bcp14">MUST NOT</span>
construct a request that includes a 100-continue expectation; the <span id="iref-oblivious-gateway-resource-178" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> <span class="bcp14">MUST</span> generate an error if a 100-continue expectation is
received.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="errors">
<section id="section-5.2">
        <h3 id="name-errors">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-errors" class="section-name selfRef">Errors</a>
        </h3>
<p id="section-5.2-1">A server that receives an invalid message for any reason <span class="bcp14">MUST</span> generate an HTTP
response with a 4xx status code.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Errors detected by the <span id="iref-oblivious-relay-resource-17" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> and errors detected by the
<span id="iref-oblivious-gateway-resource-18" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> before removing protection (including being unable to
remove encapsulation for any reason) result in the status code being sent
without protection in response to the POST request made to that resource.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">Errors detected by the <span id="iref-oblivious-gateway-resource-181" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> after successfully removing
encapsulation and errors detected by the <span id="iref-target-resource-182" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> <span class="bcp14">MUST</span> be sent in an
<span id="iref-encapsulated-response-183" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>.  This might be because the <span id="iref-encapsulated-request-184" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> is
malformed or the <span id="iref-target-resource-185" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> does not produce a response.  In either case
the <span id="iref-oblivious-gateway-resource-186" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> can generate a response with an appropriate error
status code (such as 400 (Bad Request) or 504 (Gateway Timeout); see <span><a href="https://rfc-editor.org/rfc/rfc9110#section-15.5.1" class="relref">Section 15.5.1</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span> and <span><a href="https://rfc-editor.org/rfc/rfc9110#section-15.6.5" class="relref">Section 15.6.5</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>, respectively).  This response
is encapsulated in the same way as a successful response.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">Errors in the encapsulation of requests mean that responses cannot be
encapsulated.  This includes cases where the <span id="iref-key-configuration-187" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> is incorrect or
outdated.  The <span id="iref-oblivious-gateway-resource-188" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> can generate and send a response with
a 4xx status code to the <span id="iref-oblivious-relay-resource-18" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a>.  This response <span class="bcp14">MAY</span> be
forwarded to the <span id="iref-client-190" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> or treated by the <span id="iref-oblivious-relay-resource-19" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> as a failure.
If a <span id="iref-client-192" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> receives a response that is not an <span id="iref-encapsulated-response-193" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>, this could
indicate that the client configuration used to construct the request is
incorrect or out of date.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ohttp-key-problem">
<section id="section-5.3">
        <h3 id="name-signaling-key-configuration">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-signaling-key-configuration" class="section-name selfRef">Signaling Key Configuration Problems</a>
        </h3>
<p id="section-5.3-1">The problem type <span>[<a href="#PROBLEM" class="cite xref">PROBLEM</a>]</span> of
"https://iana.org/assignments/http-problem-types#ohttp-key" is defined.  An
<span id="iref-oblivious-gateway-resource-194" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> <span class="bcp14">MAY</span> use this problem type in a response to indicate
that an <span id="iref-encapsulated-request-195" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> used an outdated or incorrect <span id="iref-key-configuration-196" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a>.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2"><a href="#fig-key-problem" class="auto internal xref">Figure 7</a> shows an example response in HTTP/1.1 format.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<span id="name-example-rejection-of-key-co"></span><div id="fig-key-problem">
<figure id="figure-7">
          <div class="lang-http-message sourcecode" id="section-5.3-3.1">
<pre>
HTTP/1.1 400 Bad Request
Date: Mon, 07 Feb 2022 00:28:05 GMT
Content-Type: application/problem+json
Content-Length: 106

{"type":"https://iana.org/assignments/http-problem-types#ohttp-key",
"title": "key identifier unknown"}
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-example-rejection-of-key-co" class="selfRef">Example Rejection of Key Configuration</a>
          </figcaption></figure>
</div>
<p id="section-5.3-4">As this response cannot be encrypted, it might not reach the <span id="iref-client-197" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>.  A <span id="iref-client-198" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>
cannot rely on the <span id="iref-oblivious-gateway-resource-199" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> using this problem type.  A <span id="iref-client-200" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>
might also be configured to disregard responses that are not encapsulated on the
basis that they might be subject to observation or modification by an <span id="iref-oblivious-relay-resource-20" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious
Relay Resource</a>.  A <span id="iref-client-202" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> might manage the risk of an outdated <span id="iref-key-configuration-203" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a>
using a heuristic approach whereby it periodically refreshes its <span id="iref-key-configuration-204" class="iref"></span><a href="#key-configuration" class="internal xref">key
configuration</a> if it receives a response with an error status code that has not
been encapsulated.<a href="#section-5.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">In this design, a <span id="iref-client-205" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> wishes to make a request to an <span id="iref-oblivious-gateway-resource-20" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>
that is forwarded to a <span id="iref-target-resource-207" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>. The <span id="iref-client-208" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> wishes to make this request without
linking that request with either:<a href="#section-6-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-2">
<li id="section-6-2.1">
          <p id="section-6-2.1.1">The identity at the network and transport layer of the <span id="iref-client-209" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> (that is, the
<span id="iref-client-210" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> IP address and TCP or UDP port number the <span id="iref-client-211" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> uses to create a
connection).<a href="#section-6-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-2.2">
          <p id="section-6-2.2.1">Any other request the <span id="iref-client-212" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> might have made in the past or might make in
the future.<a href="#section-6-2.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-6-3">In order to ensure this, the <span id="iref-client-213" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> selects a relay (that serves the
<span id="iref-oblivious-relay-resource-21" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a>) that it trusts will protect this information
by forwarding the <span id="iref-encapsulated-request-215" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> and Response without passing it
to the server (that serves the <span id="iref-oblivious-gateway-resource-21" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>).<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">In this section, a deployment where there are three entities is considered:<a href="#section-6-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-5.1">
          <p id="section-6-5.1.1">A <span id="iref-client-217" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> makes requests and receives responses<a href="#section-6-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-5.2">
          <p id="section-6-5.2.1">A relay operates the <span id="iref-oblivious-relay-resource-218" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a><a href="#section-6-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-5.3">
          <p id="section-6-5.3.1">A server operates both the <span id="iref-oblivious-gateway-resource-219" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> and the <span id="iref-target-resource-220" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a><a href="#section-6-5.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-6-6"><a href="#separate-target" class="auto internal xref">Section 6.10</a> discusses the security implications for a case where
different servers operate the <span id="iref-oblivious-gateway-resource-221" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> and <span id="iref-target-resource-222" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>.<a href="#section-6-6" class="pilcrow">¶</a></p>
<p id="section-6-7">Requests from the <span id="iref-client-223" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> to <span id="iref-oblivious-relay-resource-22" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> and from <span id="iref-oblivious-relay-resource-225" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay
Resource</a> to <span id="iref-oblivious-gateway-resource-226" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> <span class="bcp14">MUST</span> use HTTPS in order to provide
unlinkability in the presence of a network observer.<a href="#section-6-7" class="pilcrow">¶</a></p>
<p id="section-6-8">To achieve the stated privacy goals, the <span id="iref-oblivious-relay-resource-227" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> cannot be
operated by the same entity as the <span id="iref-oblivious-gateway-resource-228" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>. However,
colocation of the <span id="iref-oblivious-gateway-resource-229" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> and <span id="iref-target-resource-230" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> simplifies the
interactions between those resources without affecting <span id="iref-client-231" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> privacy.<a href="#section-6-8" class="pilcrow">¶</a></p>
<p id="section-6-9">As a consequence of this configuration, Oblivious HTTP prevents linkability
described above. Informally, this means:<a href="#section-6-9" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-10">
<li id="section-6-10.1">
          <p id="section-6-10.1.1">Requests and responses are known only to <span id="iref-clients-232" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> and <span id="iref-oblivious-gateway-resources-" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a>.
In particular, the <span id="iref-oblivious-relay-resource-23" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> knows the origin and destination
of an <span id="iref-encapsulated-request-235" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> and Response, yet does not know the decrypted contents.
Likewise, <span id="iref-oblivious-gateway-resources-2" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a> learn only the <span id="iref-oblivious-relay-resource-237" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> and
the decrypted request.  No entity other than the <span id="iref-client-238" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> can see the plaintext
request and response and can attribute them to the <span id="iref-client-239" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>.<a href="#section-6-10.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-10.2">
          <p id="section-6-10.2.1">Oblivous Gateway Resources, and therefore Target Resources, cannot link requests
from the same <span id="iref-client-240" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> in the absence of unique per-<span id="iref-client-241" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> keys.<a href="#section-6-10.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-6-11">Traffic analysis that might affect these properties are outside the scope of
this document; see <a href="#ta" class="auto internal xref">Section 6.2.3</a>.<a href="#section-6-11" class="pilcrow">¶</a></p>
<p id="section-6-12">A formal analysis of Oblivious HTTP is in <span>[<a href="#OHTTP-ANALYSIS" class="cite xref">OHTTP-ANALYSIS</a>]</span>.<a href="#section-6-12" class="pilcrow">¶</a></p>
<div id="sec-client">
<section id="section-6.1">
        <h3 id="name-client-responsibilities">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-client-responsibilities" class="section-name selfRef">Client Responsibilities</a>
        </h3>
<p id="section-6.1-1">Because <span id="iref-clients-242" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> do not authenticate the <span id="iref-target-resource-243" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> when using Oblivious
HTTP, <span id="iref-clients-244" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> <span class="bcp14">MUST</span> have some mechanism to authorize an <span id="iref-oblivious-gateway-resource-24" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a> for use with a <span id="iref-target-resource-246" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>. One possible means of authorization is
an allowlist.  This ensures that <span id="iref-oblivious-gateway-resources-24" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a> are not abused to
forward traffic to arbitrary Target Resources. <a href="#server-responsibilities" class="auto internal xref">Section 6.3</a>
describes similar responsibilities that apply to <span id="iref-oblivious-gateway-resources-248" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a>.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2"><span id="iref-clients-249" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> <span class="bcp14">MUST</span> ensure that the <span id="iref-key-configuration-250" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> they select for generating
Encapsulated Requests is integrity protected and authenticated so that it can
be attributed to the <span id="iref-oblivious-gateway-resource-251" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>; see <a href="#key-configuration" class="auto internal xref">Section 3</a>.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">Since <span id="iref-clients-252" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> connect directly to the <span id="iref-oblivious-relay-resource-25" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> instead of the <span id="iref-target-resource-254" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>, application
configurations wherein <span id="iref-clients-255" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> make policy decisions about target connections,
e.g., to apply certificate pinning, are incompatible with Oblivious HTTP.  In
such cases, alternative technologies such as HTTP CONNECT
(<span><a href="https://rfc-editor.org/rfc/rfc9110#section-9.3.6" class="relref">Section 9.3.6</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>) can be used. Applications could implement related
policies on <span id="iref-key-configurations-256" class="iref"></span><a href="#key-configuration" class="internal xref">key configurations</a> and relay connections, though these might not
provide the same properties as policies enforced directly on target
connections. When this difference is relevant, applications can instead connect
directly to the target at the cost of either privacy or performance.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4"><span id="iref-clients-257" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> cannot carry connection-level state between requests as they only
establish direct connections to the relay responsible for the Oblivious Relay
resource.  However, the content of requests might be used by a server to
correlate requests.  Cookies <span>[<a href="#COOKIES" class="cite xref">COOKIES</a>]</span> are the most obvious feature
that might be used to correlate requests, but any identity information and
authentication credentials might have the same effect.  <span id="iref-clients-258" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> also need to
treat information learned from responses with similar care when constructing
subsequent requests, which includes the identity of resources.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5"><span id="iref-clients-259" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> <span class="bcp14">MUST</span> generate a new HPKE context for every request, using a good source
of entropy (<span>[<a href="#RANDOM" class="cite xref">RANDOM</a>]</span>) for generating keys. Key reuse not only risks
requests being linked, reuse could expose request and response contents to the
relay.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<p id="section-6.1-6">The request the <span id="iref-client-260" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> sends to the <span id="iref-oblivious-relay-resource-26" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> only requires
minimal information; see <a href="#http-usage" class="auto internal xref">Section 5</a>. The request that carries the
<span id="iref-encapsulated-request-262" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> and is sent to the <span id="iref-oblivious-relay-resource-263" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> <span class="bcp14">MUST NOT</span>
include identifying information unless the <span id="iref-client-264" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> can trust that this
information is removed by the relay. A <span id="iref-client-265" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> <span class="bcp14">MAY</span> include information only for
the <span id="iref-oblivious-relay-resource-266" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> in header fields identified by the Connection
header field if it trusts the relay to remove these as required by <span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.6.1" class="relref">Section 7.6.1</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>. The <span id="iref-client-267" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> needs to trust that the relay does not replicate the
source addressing information in the request it forwards.<a href="#section-6.1-6" class="pilcrow">¶</a></p>
<p id="section-6.1-7"><span id="iref-clients-268" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> rely on the <span id="iref-oblivious-relay-resource-269" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> to forward Encapsulated Requests
and responses. However, the relay can only refuse to forward messages, it
cannot inspect or modify the contents of Encapsulated Requests or responses.<a href="#section-6.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="relay-responsibilities">
<section id="section-6.2">
        <h3 id="name-relay-responsibilities">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-relay-responsibilities" class="section-name selfRef">Relay Responsibilities</a>
        </h3>
<p id="section-6.2-1">The relay that serves the <span id="iref-oblivious-relay-resource-27" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> has a very simple function
to perform. For each request it receives, it makes a request of the <span id="iref-oblivious-gateway-resource-27" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> that includes the same content. When it receives a response,
it sends a response to the <span id="iref-client-272" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> that includes the content of the response
from the <span id="iref-oblivious-gateway-resource-273" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">When forwarding a request, the relay <span class="bcp14">MUST</span> follow the forwarding rules in
<span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.6" class="relref">Section 7.6</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>.  A generic HTTP intermediary implementation is suitable
for the purposes of serving an <span id="iref-oblivious-relay-resource-274" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a>, but additional care is
needed to ensure that <span id="iref-client-275" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> privacy is maintained.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">Firstly, a generic implementation will forward unknown fields.  For Oblivious
HTTP, an <span id="iref-oblivious-relay-resource-276" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> <span class="bcp14">SHOULD NOT</span> forward unknown fields.  Though
<span id="iref-clients-277" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> are not expected to include fields that might contain identifying
information, removing unknown fields removes this privacy risk.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">Secondly, generic implementations are often configured to augment requests with
information about the <span id="iref-client-278" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>, such as the Via field or the Forwarded field
<span>[<a href="#FORWARDED" class="cite xref">FORWARDED</a>]</span>.  A relay <span class="bcp14">MUST NOT</span> add information when forwarding
requests that might be used to identify <span id="iref-clients-279" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>, except for information that
a <span id="iref-client-280" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> is aware of; see <a href="#differential" class="auto internal xref">Section 6.2.1</a>.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2-5">Finally, a relay can also generate responses, though it is assumed to not be able
to examine the content of a request (other than to observe the choice of key
identifier, KDF, and AEAD), so it is also assumed that it cannot generate an
<span id="iref-encapsulated-response-281" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>.<a href="#section-6.2-5" class="pilcrow">¶</a></p>
<div id="differential">
<section id="section-6.2.1">
          <h4 id="name-differential-treatment">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-differential-treatment" class="section-name selfRef">Differential Treatment</a>
          </h4>
<p id="section-6.2.1-1">A relay <span class="bcp14">MAY</span> add information to requests if the <span id="iref-client-282" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> is aware of the nature of
the information that could be added.  Any addition <span class="bcp14">MUST NOT</span> include information
that uniquely and permanently identifies the <span id="iref-client-283" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>, including any pseudonymous identifier.
Information added by the relay - beyond what is already revealed through
encapsulated requests from <span id="iref-clients-284" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> - can reduce the size of the anonymity set of
<span id="iref-clients-285" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> at a gateway.<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-2">A <span id="iref-client-286" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> does not need to be aware of the exact value added for each request,
but needs to know the range of possible values the relay might use.  How
a <span id="iref-client-287" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> might learn about added information is not defined in this document.<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
<p id="section-6.2.1-3">Moreover, relays <span class="bcp14">MAY</span> apply differential treatment to <span id="iref-clients-288" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> that engage in abusive
behavior, e.g., by sending too many requests in comparison to other <span id="iref-clients-289" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>,
or as a response to rate limits signalled from the gateway. Any such
differential treatment can reveal information to the gateway that would not
be revealed otherwise and therefore reduce the size of the anonymity set of
<span id="iref-clients-290" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> using a gateway. For example, if a relay chooses to rate limit or
block an abusive <span id="iref-client-291" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>, this means that any <span id="iref-client-292" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> requests which are not
treated this way are known to be non-abusive by the gateway. <span id="iref-clients-293" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> need to
consider the likelihood of such differential treatment and the privacy
risks when using a relay.<a href="#section-6.2.1-3" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4">Some patterns of abuse cannot be detected without access to the request that
is made to the target. This means that only the gateway or target are in a
position to identify abuse. A gateway <span class="bcp14">MAY</span> send signals toward the relay to
provide feedback about specific requests. For example, a gateway could respond
differently to requests it cannot decapsulate, as mentioned in <a href="#errors" class="auto internal xref">Section 5.2</a>. A
relay that acts on this feedback could - either inadvertently or by
design - lead to <span id="iref-client-294" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> deanonymization.<a href="#section-6.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dos">
<section id="section-6.2.2">
          <h4 id="name-denial-of-service">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-denial-of-service" class="section-name selfRef">Denial of Service</a>
          </h4>
<p id="section-6.2.2-1">As there are privacy benefits from having a large rate of requests forwarded by
the same relay (see <a href="#ta" class="auto internal xref">Section 6.2.3</a>), servers that operate the <span id="iref-oblivious-gateway-resource-29" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>
might need an arrangement with <span id="iref-oblivious-relay-resources-2" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resources</a>. This arrangement might
be necessary to prevent having the large volume of requests being classified as
an attack by the server.<a href="#section-6.2.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2.2-2">If a server accepts a larger volume of requests from a relay, it needs to
trust that the relay does not allow abusive levels of request volumes from
<span id="iref-clients-297" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>. That is, if a server allows requests from the relay to be exempt from
rate limits, the server might want to ensure that the relay applies a rate
limiting policy that is acceptable to the server.<a href="#section-6.2.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2.2-3">Servers that enter into an agreement with a relay that enables a higher request
rate might choose to authenticate the relay to enable the higher rate.<a href="#section-6.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ta">
<section id="section-6.2.3">
          <h4 id="name-traffic-analysis">
<a href="#section-6.2.3" class="section-number selfRef">6.2.3. </a><a href="#name-traffic-analysis" class="section-name selfRef">Traffic Analysis</a>
          </h4>
<p id="section-6.2.3-1">Using HTTPS protects information about which resources are the subject of
request and prevents a network observer from being able to trivially correlate
messages on either side of a relay.  However, using HTTPS does not prevent
traffic analysis by such network observers.<a href="#section-6.2.3-1" class="pilcrow">¶</a></p>
<p id="section-6.2.3-2">The time at which <span id="iref-encapsulated-request-298" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> or response messages are sent can
reveal information to a network observer. Though messages exchanged between the
<span id="iref-oblivious-relay-resource-29" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> and the <span id="iref-oblivious-gateway-resource-30" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> might be sent in a
single connection, traffic analysis could be used to match messages that are
forwarded by the relay.<a href="#section-6.2.3-2" class="pilcrow">¶</a></p>
<p id="section-6.2.3-3">A relay could, as part of its function, delay requests before forwarding them.
Delays might increase the anonymity set into which each request is
attributed. Any delay also increases the time that a <span id="iref-client-301" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> waits for a
response, so delays <span class="bcp14">SHOULD</span> only be added with the consent - or at least
awareness - of <span id="iref-clients-302" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>.<a href="#section-6.2.3-3" class="pilcrow">¶</a></p>
<p id="section-6.2.3-4">A relay that forwards large volumes of exchanges can provide better privacy by
providing larger sets of messages that need to be matched.<a href="#section-6.2.3-4" class="pilcrow">¶</a></p>
<p id="section-6.2.3-5">Traffic analysis is not restricted to network observers. A malicious <span id="iref-oblivious-relay-resource-303" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> could
use traffic analysis to learn information about otherwise encrypted requests
and responses relayed between <span id="iref-clients-304" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> and gateways. An <span id="iref-oblivious-relay-resource-305" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> terminates
TLS connections from <span id="iref-clients-306" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>, so they see message boundaries. This privileged
position allows for richer feature extraction from encrypted data, which might
improve traffic analysis.<a href="#section-6.2.3-5" class="pilcrow">¶</a></p>
<p id="section-6.2.3-6"><span id="iref-clients-307" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> and <span id="iref-oblivious-gateway-resources-3" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a> can use padding to reduce the
effectiveness of traffic analysis.  Padding is a capability provided by binary
HTTP messages; see <span><a href="https://rfc-editor.org/rfc/rfc9292#section-3.8" class="relref">Section 3.8</a> of [<a href="#BINARY" class="cite xref">BINARY</a>]</span>.  If the encapsulation method
described in this document is used to protect a different message type (see
<a href="#repurposing" class="auto internal xref">Section 4.6</a>), that message format might need to include padding support.
<span id="iref-oblivious-relay-resources-3" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resources</a> can also use padding for the same reason, but need to
operate at the HTTP layer since they cannot manipulate binary HTTP messages; for example,
see <span><a href="https://rfc-editor.org/rfc/rfc9113#section-10.7" class="relref">Section 10.7</a> of [<a href="#HTTP2" class="cite xref">HTTP/2</a>]</span> or <span><a href="https://rfc-editor.org/rfc/rfc9114#section-10.7" class="relref">Section 10.7</a> of [<a href="#HTTP3" class="cite xref">HTTP/3</a>]</span>).<a href="#section-6.2.3-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="server-responsibilities">
<section id="section-6.3">
        <h3 id="name-server-responsibilities">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-server-responsibilities" class="section-name selfRef">Server Responsibilities</a>
        </h3>
<p id="section-6.3-1">The <span id="iref-oblivious-gateway-resource-31" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> can be operated by a different entity than the
<span id="iref-target-resource-311" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>.  However, this means that the <span id="iref-client-312" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> needs to trust the
<span id="iref-oblivious-gateway-resource-313" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> not to modify requests or responses.  This analysis
concerns itself with a deployment scenario where a single server provides both
the <span id="iref-oblivious-gateway-resource-314" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> and <span id="iref-target-resource-315" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">A server that operates both Oblivious Gateway and Target Resources is
responsible for removing request encryption, generating a response to the
<span id="iref-encapsulated-request-316" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>, and encrypting the response.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">Servers should account for traffic analysis based on response size or generation
time.  Techniques such as padding or timing delays can help protect against such
attacks; see <a href="#ta" class="auto internal xref">Section 6.2.3</a>.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3-4">If separate entities provide the <span id="iref-oblivious-gateway-resource-317" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> and <span id="iref-target-resource-318" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>,
these entities might need an arrangement similar to that between server and
relay for managing denial of service; see <a href="#dos" class="auto internal xref">Section 6.2.2</a>. Moreover, the <span id="iref-oblivious-gateway-resource-319" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> <span class="bcp14">SHOULD</span> have some mechanism to ensure that the <span id="iref-oblivious-gateway-resource-32" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a> is not misused as a relay for HTTP messages to an arbitrary <span id="iref-target-resource-321" class="iref"></span><a href="#dfn-target" class="internal xref">Target
Resource</a>, such as an allowlist.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
<p id="section-6.3-5">Non-secure requests - such as those with the "http" scheme as opposed to the
"https" scheme - <span class="bcp14">SHOULD NOT</span> be used if the Oblivious Gateway and Target
Resources are not on the same origin.  If messages are forwarded between these
resources without the protections afforded by HTTPS, they could be inspected or
modified by a network attacker.  Note that a request could be forwarded without
protection if the two resources share an origin.<a href="#section-6.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-management">
<section id="section-6.4">
        <h3 id="name-key-management">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-key-management" class="section-name selfRef">Key Management</a>
        </h3>
<p id="section-6.4-1">An <span id="iref-oblivious-gateway-resource-322" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> needs to have a plan for replacing keys. This
might include regular replacement of keys, which can be assigned new key
identifiers. If an <span id="iref-oblivious-gateway-resource-323" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> receives a request that contains a
key identifier that it does not understand or that corresponds to a key that has
been replaced, the server can respond with an HTTP 422 (Unprocessable Content)
status code.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">A server can also use a 422 status code if the server has a key that corresponds
to the key identifier, but the <span id="iref-encapsulated-request-324" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> cannot be successfully
decrypted using the key.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<p id="section-6.4-3">A server <span class="bcp14">MUST</span> ensure that the HPKE keys it uses are not valid for any other
protocol that uses HPKE with the "message/bhttp request" label.  Designers of
protocols that reuse this encryption format, especially new versions of this
protocol, can ensure key diversity by choosing a different label in their use of
HPKE.  The "message/bhttp response" label was chosen for symmetry only as it
provides key diversity only within the HPKE context created using the
"message/bhttp request" label; see <a href="#repurposing" class="auto internal xref">Section 4.6</a>.<a href="#section-6.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="replay">
<section id="section-6.5">
        <h3 id="name-replay-attacks">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-replay-attacks" class="section-name selfRef">Replay Attacks</a>
        </h3>
<p id="section-6.5-1">A server is responsible for either rejecting replayed requests or ensuring that
the effect of replays does not adversely affect <span id="iref-clients-325" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> or resources.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
<p id="section-6.5-2">Encrypted requests can be copied and replayed by the Oblivious Relay
resource. The threat model for Oblivious HTTP allows the possibility that an
<span id="iref-oblivious-relay-resource-326" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> might replay requests. Furthermore, if a <span id="iref-client-327" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> sends
an <span id="iref-encapsulated-request-328" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> in TLS early data (see <span><a href="https://rfc-editor.org/rfc/rfc8446#section-8" class="relref">Section 8</a> of [<a href="#TLS" class="cite xref">TLS</a>]</span> and
<span>[<a href="#RFC8470" class="cite xref">RFC8470</a>]</span>), a network-based adversary might be able to cause the request to
be replayed. In both cases, the effect of a replay attack and the mitigations
that might be employed are similar to TLS early data.<a href="#section-6.5-2" class="pilcrow">¶</a></p>
<p id="section-6.5-3">It is the responsibility of the application that uses Oblivious HTTP to either
reject replayed requests or to ensure that replayed requests have no adverse
effects on their operation.  This section describes some approaches that are
universally applicable and suggestions for more targeted techniques.<a href="#section-6.5-3" class="pilcrow">¶</a></p>
<p id="section-6.5-4">A <span id="iref-client-329" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> or <span id="iref-oblivious-relay-resource-33" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> <span class="bcp14">MUST NOT</span> automatically attempt to retry a
failed request unless it receives a positive signal indicating that the request
was not processed or forwarded. The HTTP/2 REFUSED_STREAM error code (<span><a href="https://rfc-editor.org/rfc/rfc9113#section-8.1.4" class="relref">Section 8.1.4</a> of [<a href="#HTTP2" class="cite xref">HTTP/2</a>]</span>), the HTTP/3 H3_REQUEST_REJECTED error code (<span><a href="https://rfc-editor.org/rfc/rfc9114#section-8.1" class="relref">Section 8.1</a> of [<a href="#HTTP3" class="cite xref">HTTP/3</a>]</span>), or a GOAWAY frame with a low enough identifier (in either protocol
version) are all sufficient signals that no processing occurred. HTTP/1.1
<span>[<a href="#HTTP11" class="cite xref">HTTP/1.1</a>]</span> provides no equivalent signal.  Connection failures or interruptions
are not sufficient signals that no processing occurred.<a href="#section-6.5-4" class="pilcrow">¶</a></p>
<p id="section-6.5-5">The anti-replay mechanisms described in <span><a href="https://rfc-editor.org/rfc/rfc8446#section-8" class="relref">Section 8</a> of [<a href="#TLS" class="cite xref">TLS</a>]</span> are generally
applicable to Oblivious HTTP requests. The encapsulated keying material (or
<code>enc</code>) can be used in place of a nonce to uniquely identify a request.  This
value is a high-entropy value that is freshly generated for every request, so
two valid requests will have different values with overwhelming probability.<a href="#section-6.5-5" class="pilcrow">¶</a></p>
<p id="section-6.5-6">The mechanism used in TLS for managing differences in <span id="iref-client-331" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> and server clocks
cannot be used as it depends on being able to observe previous interactions.
Oblivious HTTP explicitly prevents such linkability.<a href="#section-6.5-6" class="pilcrow">¶</a></p>
<p id="section-6.5-7">The considerations in <span>[<a href="#RFC8470" class="cite xref">RFC8470</a>]</span> as they relate to managing the risk of
replay also apply, though there is no option to delay the processing of a
request.<a href="#section-6.5-7" class="pilcrow">¶</a></p>
<p id="section-6.5-8">Limiting requests to those with safe methods might not be satisfactory for some
applications, particularly those that involve the submission of data to a
server. The use of idempotent methods might be of some use in managing replay
risk, though it is important to recognize that different idempotent requests
can be combined to be not idempotent.<a href="#section-6.5-8" class="pilcrow">¶</a></p>
<p id="section-6.5-9">Even without replay prevention, the server-chosen <code>response_nonce</code> field
ensures that responses have unique AEAD keys and nonces even when requests are
replayed.<a href="#section-6.5-9" class="pilcrow">¶</a></p>
<div id="use-of-date-for-anti-replay">
<section id="section-6.5.1">
          <h4 id="name-use-of-date-for-anti-replay">
<a href="#section-6.5.1" class="section-number selfRef">6.5.1. </a><a href="#name-use-of-date-for-anti-replay" class="section-name selfRef">Use of Date for Anti-Replay</a>
          </h4>
<p id="section-6.5.1-1"><span id="iref-clients-332" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> <span class="bcp14">SHOULD</span> include a <code>Date</code> header field in Encapsulated Requests, unless
the <span id="iref-client-333" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> has prior knowledge that indicates that the <span id="iref-oblivious-gateway-resource-334" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a> does not use <code>Date</code> for anti-replay purposes.<a href="#section-6.5.1-1" class="pilcrow">¶</a></p>
<p id="section-6.5.1-2">Though HTTP requests often do not include a <code>Date</code> header field, the value of
this field might be used by a server to limit the amount of requests it needs to
track if it needs to prevent replay attacks.<a href="#section-6.5.1-2" class="pilcrow">¶</a></p>
<p id="section-6.5.1-3">An <span id="iref-oblivious-gateway-resource-335" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> can maintain state for requests for a small window
of time over which it wishes to accept requests.  The <span id="iref-oblivious-gateway-resource-336" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>
can store all requests it processes within this window.  Storing just the <code>enc</code>
field of a request, which should be unique to each request, is sufficient.  The
<span id="iref-oblivious-gateway-resource-337" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> can reject any request that is the same as one that
was previously answered within that time window or if the <code>Date</code> header field
from the decrypted request is outside of the current time window.<a href="#section-6.5.1-3" class="pilcrow">¶</a></p>
<p id="section-6.5.1-4"><span id="iref-oblivious-gateway-resources-33" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a> might need to allow for the time it takes requests
to arrive from the <span id="iref-client-339" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>, with a time window that is large enough to allow for
differences in clocks.  Insufficient tolerance of time differences could result
in valid requests being unnecessarily rejected.  Beyond allowing for multiple
round trip times -- to account for retransmission -- network delays are unlikely
to be significant in determining the size of the window, unless all potential
<span id="iref-clients-340" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> are known to have excellent time-keeping.  A specific window size might
need to be determined experimentally.<a href="#section-6.5.1-4" class="pilcrow">¶</a></p>
<p id="section-6.5.1-5"><span id="iref-oblivious-gateway-resources-34" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a> <span class="bcp14">MUST NOT</span> treat the time window as secret
information. An attacker can actively probe with different values for the <code>Date</code>
field to determine the time window over which the server will accept responses.<a href="#section-6.5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="date-fix">
<section id="section-6.5.2">
          <h4 id="name-correcting-clock-difference">
<a href="#section-6.5.2" class="section-number selfRef">6.5.2. </a><a href="#name-correcting-clock-difference" class="section-name selfRef">Correcting Clock Differences</a>
          </h4>
<p id="section-6.5.2-1">An <span id="iref-oblivious-gateway-resource-342" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> can reject requests that contain a <code>Date</code> value
that is outside of its active window with a 400 series status code.  The problem
type <span>[<a href="#PROBLEM" class="cite xref">PROBLEM</a>]</span> of
"https://iana.org/assignments/http-problem-types#date" is defined to allow the
server to signal that the <code>Date</code> value in the request was unacceptable.<a href="#section-6.5.2-1" class="pilcrow">¶</a></p>
<p id="section-6.5.2-2"><a href="#fig-date-reject" class="auto internal xref">Figure 8</a> shows an example response in HTTP/1.1 format.<a href="#section-6.5.2-2" class="pilcrow">¶</a></p>
<span id="name-example-rejection-of-reques"></span><div id="fig-date-reject">
<figure id="figure-8">
            <div class="lang-http-message sourcecode" id="section-6.5.2-3.1">
<pre>
HTTP/1.1 400 Bad Request
Date: Mon, 07 Feb 2022 00:28:05 GMT
Content-Type: application/problem+json
Content-Length: 128

{"type":"https://iana.org/assignments/http-problem-types#date",
"title": "date field in request outside of acceptable range"}
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-example-rejection-of-reques" class="selfRef">Example Rejection of Request Date Field</a>
            </figcaption></figure>
</div>
<p id="section-6.5.2-4">Disagreements about time are unlikely if both <span id="iref-client-343" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> and <span id="iref-oblivious-gateway-resource-344" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a> have a good source of time; see <span>[<a href="#NTP" class="cite xref">NTP</a>]</span>. However, clock
differences are known to be commonplace; see Section 7.1 of
<span>[<a href="#CLOCKSKEW" class="cite xref">CLOCKSKEW</a>]</span>.<a href="#section-6.5.2-4" class="pilcrow">¶</a></p>
<p id="section-6.5.2-5">Including a <code>Date</code> header field in the response allows the <span id="iref-client-345" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> to correct
clock errors by retrying the same request using the value of the <code>Date</code> field
provided by the <span id="iref-oblivious-gateway-resource-346" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>.  The value of the <code>Date</code> field can
be copied if the response is fresh, with an adjustment based on the <code>Age</code> field
otherwise; see <span><a href="https://rfc-editor.org/rfc/rfc9111#section-4.2" class="relref">Section 4.2</a> of [<a href="#HTTP-CACHING" class="cite xref">HTTP-CACHING</a>]</span>.  When retrying a request, the
<span id="iref-client-347" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> <span class="bcp14">MUST</span> create a fresh encryption of the modified request, using a new HPKE
context.<a href="#section-6.5.2-5" class="pilcrow">¶</a></p>
<span id="name-retrying-with-an-updated-da"></span><div id="fig-retry-date">
<figure id="figure-9">
            <div id="section-6.5.2-6.1">
              <div class="alignLeft art-svg artwork" id="section-6.5.2-6.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="304" width="464" viewBox="0 0 464 304" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,32 L 8,80" fill="none" stroke="black"></path>
                  <path d="M 48,80 L 48,288" fill="none" stroke="black"></path>
                  <path d="M 88,32 L 88,80" fill="none" stroke="black"></path>
                  <path d="M 152,32 L 152,80" fill="none" stroke="black"></path>
                  <path d="M 192,80 L 192,136" fill="none" stroke="black"></path>
                  <path d="M 192,152 L 192,200" fill="none" stroke="black"></path>
                  <path d="M 192,216 L 192,264" fill="none" stroke="black"></path>
                  <path d="M 192,280 L 192,288" fill="none" stroke="black"></path>
                  <path d="M 288,80 L 288,288" fill="none" stroke="black"></path>
                  <path d="M 312,32 L 312,80" fill="none" stroke="black"></path>
                  <path d="M 368,32 L 368,80" fill="none" stroke="black"></path>
                  <path d="M 408,80 L 408,288" fill="none" stroke="black"></path>
                  <path d="M 456,32 L 456,80" fill="none" stroke="black"></path>
                  <path d="M 8,32 L 88,32" fill="none" stroke="black"></path>
                  <path d="M 152,32 L 312,32" fill="none" stroke="black"></path>
                  <path d="M 368,32 L 456,32" fill="none" stroke="black"></path>
                  <path d="M 8,80 L 88,80" fill="none" stroke="black"></path>
                  <path d="M 152,80 L 312,80" fill="none" stroke="black"></path>
                  <path d="M 368,80 L 456,80" fill="none" stroke="black"></path>
                  <path d="M 48,142 L 280,142" fill="none" stroke="black"></path>
                  <path d="M 48,146 L 280,146" fill="none" stroke="black"></path>
                  <path d="M 288,144 L 400,144" fill="none" stroke="black"></path>
                  <path d="M 56,206 L 288,206" fill="none" stroke="black"></path>
                  <path d="M 56,210 L 288,210" fill="none" stroke="black"></path>
                  <path d="M 296,208 L 408,208" fill="none" stroke="black"></path>
                  <path d="M 48,270 L 280,270" fill="none" stroke="black"></path>
                  <path d="M 48,274 L 280,274" fill="none" stroke="black"></path>
                  <path d="M 288,272 L 400,272" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="408,272 396,266.4 396,277.6" fill="black" transform="rotate(0,400,272)"></polygon>
                  <polygon class="arrowhead" points="408,144 396,138.4 396,149.6" fill="black" transform="rotate(0,400,144)"></polygon>
                  <polygon class="arrowhead" points="304,208 292,202.4 292,213.6" fill="black" transform="rotate(180,296,208)"></polygon>
                  <polygon class="arrowhead" points="288,272 276,266.4 276,277.6" fill="black" transform="rotate(0,280,272)"></polygon>
                  <polygon class="arrowhead" points="288,144 276,138.4 276,149.6" fill="black" transform="rotate(0,280,144)"></polygon>
                  <path class="jump" d="M 192,280 C 198,280 198,264 192,264" fill="none" stroke="black"></path>
                  <path class="jump" d="M 192,216 C 186,216 186,200 192,200" fill="none" stroke="black"></path>
                  <path class="jump" d="M 192,152 C 198,152 198,136 192,136" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="64,208 52,202.4 52,213.6" fill="black" transform="rotate(180,56,208)"></polygon>
                  <g class="text">
                    <text x="44" y="52">Client</text>
                    <text x="184" y="52">Relay</text>
                    <text x="224" y="52">and</text>
                    <text x="272" y="52">Gateway</text>
                    <text x="404" y="52">Target</text>
                    <text x="232" y="68">Resources</text>
                    <text x="412" y="68">Resource</text>
                    <text x="96" y="132">Request</text>
                    <text x="312" y="180">400</text>
                    <text x="364" y="180">Response</text>
                    <text x="352" y="196">+</text>
                    <text x="380" y="196">Date</text>
                    <text x="96" y="244">Request</text>
                    <text x="72" y="260">+</text>
                    <text x="112" y="260">Updated</text>
                    <text x="164" y="260">Date</text>
                  </g>
                </svg><a href="#section-6.5.2-6.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-retrying-with-an-updated-da" class="selfRef">Retrying with an Updated Date Field</a>
            </figcaption></figure>
</div>
<p id="section-6.5.2-7">Retrying immediately allows the <span id="iref-oblivious-gateway-resource-348" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> to measure the round
trip time to the <span id="iref-client-349" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>. The observed delay might reveal something about the
location of the <span id="iref-client-350" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>.  <span id="iref-clients-351" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> could delay retries to add some uncertainty to
any observed delay.<a href="#section-6.5.2-7" class="pilcrow">¶</a></p>
<p id="section-6.5.2-8">Intermediaries can sometimes rewrite the <code>Date</code> field when forwarding responses.
This might cause problems if the <span id="iref-oblivious-gateway-resource-35" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> and intermediary
clocks differ by enough to cause the retry to be rejected.  Therefore, <span id="iref-clients-353" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>
            <span class="bcp14">MUST NOT</span> retry a request with an adjusted date more than once.<a href="#section-6.5.2-8" class="pilcrow">¶</a></p>
<p id="section-6.5.2-9"><span id="iref-oblivious-gateway-resources-35" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a> that condition their responses on the <code>Date</code> header
field <span class="bcp14">SHOULD</span> either ensure that intermediaries do not cache responses (by
including a <code>Cache-Control</code> directive of <code>no-store</code>) or designate the response
as conditional on the value of the <code>Date</code> request header field (by including the
token "date" in a <code>Vary</code> header field).<a href="#section-6.5.2-9" class="pilcrow">¶</a></p>
<p id="section-6.5.2-10"><span id="iref-clients-355" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> <span class="bcp14">MUST NOT</span> use the date provided by the <span id="iref-oblivious-gateway-resource-356" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> for any
other purpose, including future requests to any resource.  Any request that uses
information provided by the <span id="iref-oblivious-gateway-resource-357" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> might be correlated using
that information.<a href="#section-6.5.2-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="forward-secrecy">
<section id="section-6.6">
        <h3 id="name-forward-secrecy">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-forward-secrecy" class="section-name selfRef">Forward Secrecy</a>
        </h3>
<p id="section-6.6-1">This document does not provide forward secrecy for either requests or
responses during the lifetime of the <span id="iref-key-configuration-358" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a>. A measure of
forward secrecy can be provided by generating a new <span id="iref-key-configuration-359" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a>
then deleting the old keys after a suitable period.<a href="#section-6.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="post-compromise-security">
<section id="section-6.7">
        <h3 id="name-post-compromise-security">
<a href="#section-6.7" class="section-number selfRef">6.7. </a><a href="#name-post-compromise-security" class="section-name selfRef">Post-Compromise Security</a>
        </h3>
<p id="section-6.7-1">This design does not provide post-compromise security for responses.<a href="#section-6.7-1" class="pilcrow">¶</a></p>
<p id="section-6.7-2">A <span id="iref-client-360" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> only needs to retain keying material that might be used to compromise
the confidentiality and integrity of a response until that response is consumed,
so there is negligible risk associated with a <span id="iref-client-361" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> compromise.<a href="#section-6.7-2" class="pilcrow">¶</a></p>
<p id="section-6.7-3">A server retains a secret key that might be used to remove protection from
messages over much longer periods. A server compromise that provided access to
the <span id="iref-oblivious-gateway-resource-362" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> secret key could allow an attacker to recover the
plaintext of all requests sent toward affected keys and all of the responses
that were generated.<a href="#section-6.7-3" class="pilcrow">¶</a></p>
<p id="section-6.7-4">Even if server keys are compromised, an adversary cannot access messages
exchanged by the <span id="iref-client-363" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> with the <span id="iref-oblivious-relay-resource-36" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> as messages are
protected by TLS.  Use of a compromised key also requires that the <span id="iref-oblivious-relay-resource-365" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious
Relay Resource</a> cooperate with the attacker or that the attacker is able to
compromise these TLS connections.<a href="#section-6.7-4" class="pilcrow">¶</a></p>
<p id="section-6.7-5">The total number of messages affected by server key compromise can be limited by
regular rotation of server keys.<a href="#section-6.7-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-clock-exposure">
<section id="section-6.8">
        <h3 id="name-client-clock-exposure">
<a href="#section-6.8" class="section-number selfRef">6.8. </a><a href="#name-client-clock-exposure" class="section-name selfRef">Client Clock Exposure</a>
        </h3>
<p id="section-6.8-1">Including a <code>Date</code> field in requests reveals some information about the <span id="iref-client-366" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>
clock.  This might be used to fingerprint <span id="iref-clients-367" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> <span>[<a href="#UWT" class="cite xref">UWT</a>]</span> or to identify <span id="iref-clients-368" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>
that are vulnerable to attacks that depend on incorrect clocks.<a href="#section-6.8-1" class="pilcrow">¶</a></p>
<p id="section-6.8-2"><span id="iref-clients-369" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> can randomize the value that they provide for <code>Date</code> to obscure the true
value of their clock and reduce the chance of linking of requests over time.
However, this increases the risk that their request is rejected as outside the
acceptable window.<a href="#section-6.8-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-media">
<section id="section-6.9">
        <h3 id="name-media-type-security">
<a href="#section-6.9" class="section-number selfRef">6.9. </a><a href="#name-media-type-security" class="section-name selfRef">Media Type Security</a>
        </h3>
<p id="section-6.9-1">The <span id="iref-key-configuration-370" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> media type defined in <a href="#ohttp-keys" class="auto internal xref">Section 3.2</a> represents keying
material.  The content of this media type is not active (see <span><a href="https://rfc-editor.org/rfc/rfc6838#section-4.6" class="relref">Section 4.6</a> of [<a href="#RFC6838" class="cite xref">RFC6838</a>]</span>), but it governs how a <span id="iref-client-371" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> might interact with an <span id="iref-oblivious-gateway-resource-372" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a>.  The security implications of processing it are described in
<a href="#sec-client" class="auto internal xref">Section 6.1</a>; privacy implications are described in <a href="#privacy" class="auto internal xref">Section 7</a>.<a href="#section-6.9-1" class="pilcrow">¶</a></p>
<p id="section-6.9-2">The security implications of handling the message media types defined in
<a href="#req-res-media" class="auto internal xref">Section 4.5</a> is covered in other parts of this section in more detail.
However, these message media types are also encrypted encapsulations of HTTP
requests and responses.<a href="#section-6.9-2" class="pilcrow">¶</a></p>
<p id="section-6.9-3">HTTP messages contain content, which can use any media type.  In particular,
requests are processed by an Oblivious <span id="iref-target-resource-373" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>, which - as an HTTP
resource - defines how content is processed; see <span><a href="https://rfc-editor.org/rfc/rfc9110#section-3.1" class="relref">Section 3.1</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>.  HTTP
clients can also use resource identity and response content to determine how
content is processed.  Consequently, the security considerations of <span><a href="https://rfc-editor.org/rfc/rfc9110#section-17" class="relref">Section 17</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span> also apply to the handling of the content of these media types.<a href="#section-6.9-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="separate-target">
<section id="section-6.10">
        <h3 id="name-separate-gateway-and-target">
<a href="#section-6.10" class="section-number selfRef">6.10. </a><a href="#name-separate-gateway-and-target" class="section-name selfRef">Separate Gateway and Target</a>
        </h3>
<p id="section-6.10-1">This document generally assumes that the same entity operates the <span id="iref-oblivious-gateway-resource-374" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> and the <span id="iref-target-resource-375" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>.  However, as the <span id="iref-oblivious-gateway-resource-376" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a> performs generic HTTP processing, the use of forwarding cannot be
completely precluded.<a href="#section-6.10-1" class="pilcrow">¶</a></p>
<p id="section-6.10-2">The scheme specified in the <span id="iref-encapsulated-request-377" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a> determines the security
requirements for any protocol that is used between the Oblivious Gateway and
Target Resources.  Using HTTPS is <span class="bcp14">RECOMMENDED</span>; see <a href="#server-responsibilities" class="auto internal xref">Section 6.3</a>.<a href="#section-6.10-2" class="pilcrow">¶</a></p>
<p id="section-6.10-3">A <span id="iref-target-resource-378" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> that is operated on a different server from the <span id="iref-oblivious-gateway-resource-379" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> is an ordinary HTTP resource.  A <span id="iref-target-resource-380" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> can privilege
requests that are forwarded by a given <span id="iref-oblivious-gateway-resource-38" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> if it trusts
the operator of the <span id="iref-oblivious-gateway-resource-382" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> to only forward requests that
meet the expectations of the <span id="iref-target-resource-383" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>.  Otherwise, the <span id="iref-target-resource-384" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>
treats requests from an <span id="iref-oblivious-gateway-resource-385" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> no differently than any
other HTTP client.<a href="#section-6.10-3" class="pilcrow">¶</a></p>
<p id="section-6.10-4">For instance, an <span id="iref-oblivious-gateway-resource-386" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> might -- possibly with the help of
<span id="iref-oblivious-relay-resources-38" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resources</a> -- be trusted not to forward an excessive volume of
requests. This might allow the <span id="iref-target-resource-388" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> to accept a greater volume of
requests from that <span id="iref-oblivious-gateway-resource-389" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> relative to other HTTP clients.<a href="#section-6.10-4" class="pilcrow">¶</a></p>
<p id="section-6.10-5">An <span id="iref-oblivious-gateway-resource-39" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> could implement policies that improve the ability
of the <span id="iref-target-resource-391" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> to implement policy exemptions, such as only forwarding
requests toward specific Target Resources according to an allowlist; see <a href="#server-responsibilities" class="auto internal xref">Section 6.3</a>.<a href="#section-6.10-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy">
<section id="section-7">
      <h2 id="name-privacy-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-7-1">One goal of this design is that independent <span id="iref-client-392" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> requests are only linkable by
their content.  However, the choice of <span id="iref-client-393" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> configuration might be used to
correlate requests.  A <span id="iref-client-394" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> configuration includes the <span id="iref-oblivious-relay-resource-395" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay
Resource</a> URI, the Oblivious Gateway <span id="iref-key-configuration-396" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a>, and <span id="iref-oblivious-gateway-resource-397" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a> URI. A configuration is active if <span id="iref-clients-398" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> can successfully use it for interacting with a target.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2"><span id="iref-oblivious-relay-and-gateway-" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay and Gateway Resources</a> can identify when requests use the same
configuration by matching the key ID from the <span id="iref-key-configuration-400" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> or the <span id="iref-oblivious-gateway-resource-40" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious
Gateway Resource</a> URI.  The <span id="iref-oblivious-gateway-resource-402" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> might use the source
address of requests to correlate requests that use an <span id="iref-oblivious-relay-resource-40" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a>
run by the same operator.  If the <span id="iref-oblivious-gateway-resource-404" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> is willing to use
trial decryption, requests can be further separated into smaller groupings based
on the keys that are used.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">Each active <span id="iref-client-405" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> configuration partitions the <span id="iref-client-406" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> anonymity set. In
practice, it is infeasible to reduce the number of active configurations to
one. Enabling diversity in choice of <span id="iref-oblivious-relay-resource-407" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> naturally
increases the number of active configurations.  More than one configuration
might need to be active to allow for key rotation and server maintenance.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4"><span id="iref-client-408" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> privacy depends on having each configuration used by many other <span id="iref-clients-409" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>.
It is critical to prevent the use of unique <span id="iref-client-410" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> configurations, which might
be used to track individual <span id="iref-clients-411" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>, but it is also important to avoid
creating small groupings of <span id="iref-clients-412" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> that might weaken privacy protections.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">A specific method for a <span id="iref-client-413" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> to acquire configurations is not included in this
specification.  Applications using this design <span class="bcp14">MUST</span> provide accommodations to
mitigate tracking using <span id="iref-client-414" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> configurations.  <span>[<a href="#CONSISTENCY" class="cite xref">CONSISTENCY</a>]</span> provides options
for ensuring that <span id="iref-client-415" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> configurations are consistent between <span id="iref-clients-416" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a>.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">The content of requests or responses, if used in forming new requests, can be
used to correlate requests.  This includes obvious methods of linking requests,
like cookies <span>[<a href="#COOKIES" class="cite xref">COOKIES</a>]</span>, but it also includes any information in either
message that might affect how subsequent requests are formulated. For example,
<span>[<a href="#FIELDING" class="cite xref">FIELDING</a>]</span> describes how interactions that are individually stateless can be
used to build a stateful system when a <span id="iref-client-417" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> acts on the content of a response.<a href="#section-7-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="deployment">
<section id="section-8">
      <h2 id="name-operational-and-deployment-">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-operational-and-deployment-" class="section-name selfRef">Operational and Deployment Considerations</a>
      </h2>
<p id="section-8-1">This section discusses various operational and deployment considerations.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="performance-overhead">
<section id="section-8.1">
        <h3 id="name-performance-overhead">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-performance-overhead" class="section-name selfRef">Performance Overhead</a>
        </h3>
<p id="section-8.1-1">Using Oblivious HTTP adds both cryptographic overhead and latency to requests
relative to a simple HTTP request-response exchange.  Deploying relay services
that are on path between <span id="iref-clients-418" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> and servers avoids adding significant
additional delay due to network topology.  A study of a similar system
<span>[<a href="#ODOH-PETS" class="cite xref">ODOH-PETS</a>]</span> found that deploying proxies close to servers was most effective
in minimizing additional latency.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="proxy-state">
<section id="section-8.2">
        <h3 id="name-resource-mappings">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-resource-mappings" class="section-name selfRef">Resource Mappings</a>
        </h3>
<p id="section-8.2-1">This protocol assumes a fixed, one-to-one mapping between the <span id="iref-oblivious-relay-resource-41" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay
Resource</a> and the <span id="iref-oblivious-gateway-resource-42" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>. This means that any encrypted
request sent to the <span id="iref-oblivious-relay-resource-42" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> will always be forwarded to the
<span id="iref-oblivious-gateway-resource-422" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>. This constraint was imposed to simplify relay
configuration and mitigate against the <span id="iref-oblivious-relay-resource-423" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> being used as
a generic relay for unknown <span id="iref-oblivious-gateway-resources-4" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a>. The relay will only
forward for <span id="iref-oblivious-gateway-resources-42" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a> that it has explicitly configured and
allowed.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">It is possible for a server to be configured with multiple <span id="iref-oblivious-relay-resources-4" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay
Resources</a>, each for a different <span id="iref-oblivious-gateway-resource-427" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> as needed.  If the
goal is to support a large number of <span id="iref-oblivious-gateway-resources-428" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resources</a>, <span id="iref-clients-429" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> might
be provided with a URI template <span>[<a href="#TEMPLATE" class="cite xref">TEMPLATE</a>]</span>, from which multiple
<span id="iref-oblivious-relay-resources-43" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resources</a> could be constructed.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="network-management">
<section id="section-8.3">
        <h3 id="name-network-management">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-network-management" class="section-name selfRef">Network Management</a>
        </h3>
<p id="section-8.3-1">Oblivious HTTP might be incompatible with network interception regimes, such as
those that rely on configuring <span id="iref-clients-431" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> with trust anchors and intercepting TLS
connections.  While TLS might be intercepted successfully, interception
middleboxes devices might not receive updates that would allow Oblivious HTTP to
be correctly identified using the media types defined in <a href="#iana-req" class="auto internal xref">Section 9.2</a> and
<a href="#iana-res" class="auto internal xref">Section 9.3</a>.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">Oblivious HTTP has a simple key management design that is not trivially altered
to enable interception by intermediaries.  <span id="iref-clients-432" class="iref"></span><a href="#dfn-client" class="internal xref">Clients</a> that are configured to enable
interception might choose to disable Oblivious HTTP in order to ensure that
content is accessible to middleboxes.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">Please update the "Media Types" registry at
<a href="https://iana.org/assignments/media-types">https://iana.org/assignments/media-types</a> for the media types
"application/ohttp-keys" (<a href="#iana-keys" class="auto internal xref">Section 9.1</a>), "message/ohttp-req" (<a href="#iana-req" class="auto internal xref">Section 9.2</a>),
and "message/ohttp-res" (<a href="#iana-res" class="auto internal xref">Section 9.3</a>), following the procedures of
<span>[<a href="#RFC6838" class="cite xref">RFC6838</a>]</span>.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">Please update the "HTTP Problem Types" registry at
<a href="https://iana.org/assignments/http-problem-types">https://iana.org/assignments/http-problem-types</a> for the types "date"
(<a href="#iana-problem-date" class="auto internal xref">Section 9.4</a>) and "ohttp-key" (<a href="#iana-problem-ohttp-key" class="auto internal xref">Section 9.5</a>).<a href="#section-9-2" class="pilcrow">¶</a></p>
<div id="iana-keys">
<section id="section-9.1">
        <h3 id="name-application-ohttp-keys-medi">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-application-ohttp-keys-medi" class="section-name selfRef">application/ohttp-keys Media Type</a>
        </h3>
<p id="section-9.1-1">The "application/ohttp-keys" media type identifies a <span id="iref-key-configuration-433" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> used by
Oblivious HTTP.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.1-2">
          <dt id="section-9.1-2.1">Type name:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.2">
            <p id="section-9.1-2.2.1">application<a href="#section-9.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.3">Subtype name:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.4">
            <p id="section-9.1-2.4.1">ohttp-keys<a href="#section-9.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.5">Required parameters:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.6">
            <p id="section-9.1-2.6.1">N/A<a href="#section-9.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.7">Optional parameters:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.8">
            <p id="section-9.1-2.8.1">N/A<a href="#section-9.1-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.9">Encoding considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.10">
            <p id="section-9.1-2.10.1">"binary"<a href="#section-9.1-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.11">Security considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.12">
            <p id="section-9.1-2.12.1">see <a href="#sec-media" class="auto internal xref">Section 6.9</a><a href="#section-9.1-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.13">Interoperability considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.14">
            <p id="section-9.1-2.14.1">N/A<a href="#section-9.1-2.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.15">Published specification:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.16">
            <p id="section-9.1-2.16.1">this specification<a href="#section-9.1-2.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.17">Applications that use this media type:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.18">
            <p id="section-9.1-2.18.1">This type identifies a <span id="iref-key-configuration-434" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> as used by Oblivious HTTP and
applications that use Oblivious HTTP.<a href="#section-9.1-2.18.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.19">Fragment identifier considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.20">
            <p id="section-9.1-2.20.1">N/A<a href="#section-9.1-2.20.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.21">Additional information:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.22">
            <span class="break"></span><dl class="dlCompact dlParallel" id="section-9.1-2.22.1">
              <dt id="section-9.1-2.22.1.1">Magic number(s):</dt>
              <dd style="margin-left: 1.5em" id="section-9.1-2.22.1.2">N/A<a href="#section-9.1-2.22.1.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.1-2.22.1.3">Deprecated alias names for this type:</dt>
              <dd style="margin-left: 1.5em" id="section-9.1-2.22.1.4">N/A<a href="#section-9.1-2.22.1.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.1-2.22.1.5">File extension(s):</dt>
              <dd style="margin-left: 1.5em" id="section-9.1-2.22.1.6">N/A<a href="#section-9.1-2.22.1.6" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.1-2.22.1.7">Macintosh file type code(s):</dt>
              <dd style="margin-left: 1.5em" id="section-9.1-2.22.1.8">N/A<a href="#section-9.1-2.22.1.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.23">Person and email address to contact for further information:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.24">
            <p id="section-9.1-2.24.1">see Authors' Addresses section<a href="#section-9.1-2.24.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.25">Intended usage:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.26">
            <p id="section-9.1-2.26.1">COMMON<a href="#section-9.1-2.26.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.27">Restrictions on usage:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.28">
            <p id="section-9.1-2.28.1">N/A<a href="#section-9.1-2.28.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.29">Author:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.30">
            <p id="section-9.1-2.30.1">see Authors' Addresses section<a href="#section-9.1-2.30.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.31">Change controller:</dt>
          <dd style="margin-left: 1.5em" id="section-9.1-2.32">
            <p id="section-9.1-2.32.1">IETF<a href="#section-9.1-2.32.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-req">
<section id="section-9.2">
        <h3 id="name-message-ohttp-req-media-typ">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-message-ohttp-req-media-typ" class="section-name selfRef">message/ohttp-req Media Type</a>
        </h3>
<p id="section-9.2-1">The "message/ohttp-req" identifies an encrypted binary HTTP request.  This
is a binary format that is defined in <a href="#request" class="auto internal xref">Section 4.3</a>.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.2-2">
          <dt id="section-9.2-2.1">Type name:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.2">
            <p id="section-9.2-2.2.1">message<a href="#section-9.2-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.3">Subtype name:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.4">
            <p id="section-9.2-2.4.1">ohttp-req<a href="#section-9.2-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.5">Required parameters:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.6">
            <p id="section-9.2-2.6.1">N/A<a href="#section-9.2-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.7">Optional parameters:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.8">
            <p id="section-9.2-2.8.1">N/A<a href="#section-9.2-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.9">Encoding considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.10">
            <p id="section-9.2-2.10.1">"binary"<a href="#section-9.2-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.11">Security considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.12">
            <p id="section-9.2-2.12.1">see <a href="#sec-media" class="auto internal xref">Section 6.9</a><a href="#section-9.2-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.13">Interoperability considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.14">
            <p id="section-9.2-2.14.1">N/A<a href="#section-9.2-2.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.15">Published specification:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.16">
            <p id="section-9.2-2.16.1">this specification<a href="#section-9.2-2.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.17">Applications that use this media type:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.18">
            <p id="section-9.2-2.18.1">Oblivious HTTP and applications that use Oblivious HTTP use this media type to
identify encapsulated binary HTTP requests.<a href="#section-9.2-2.18.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.19">Fragment identifier considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.20">
            <p id="section-9.2-2.20.1">N/A<a href="#section-9.2-2.20.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.21">Additional information:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.22">
            <span class="break"></span><dl class="dlCompact dlParallel" id="section-9.2-2.22.1">
              <dt id="section-9.2-2.22.1.1">Magic number(s):</dt>
              <dd style="margin-left: 1.5em" id="section-9.2-2.22.1.2">N/A<a href="#section-9.2-2.22.1.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.2-2.22.1.3">Deprecated alias names for this type:</dt>
              <dd style="margin-left: 1.5em" id="section-9.2-2.22.1.4">N/A<a href="#section-9.2-2.22.1.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.2-2.22.1.5">File extension(s):</dt>
              <dd style="margin-left: 1.5em" id="section-9.2-2.22.1.6">N/A<a href="#section-9.2-2.22.1.6" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.2-2.22.1.7">Macintosh file type code(s):</dt>
              <dd style="margin-left: 1.5em" id="section-9.2-2.22.1.8">N/A<a href="#section-9.2-2.22.1.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.23">Person and email address to contact for further information:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.24">
            <p id="section-9.2-2.24.1">see Authors' Addresses section<a href="#section-9.2-2.24.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.25">Intended usage:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.26">
            <p id="section-9.2-2.26.1">COMMON<a href="#section-9.2-2.26.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.27">Restrictions on usage:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.28">
            <p id="section-9.2-2.28.1">N/A<a href="#section-9.2-2.28.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.29">Author:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.30">
            <p id="section-9.2-2.30.1">see Authors' Addresses section<a href="#section-9.2-2.30.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.31">Change controller:</dt>
          <dd style="margin-left: 1.5em" id="section-9.2-2.32">
            <p id="section-9.2-2.32.1">IETF<a href="#section-9.2-2.32.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-res">
<section id="section-9.3">
        <h3 id="name-message-ohttp-res-media-typ">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-message-ohttp-res-media-typ" class="section-name selfRef">message/ohttp-res Media Type</a>
        </h3>
<p id="section-9.3-1">The "message/ohttp-res" identifies an encrypted binary HTTP response. This
is a binary format that is defined in <a href="#response" class="auto internal xref">Section 4.4</a>.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.3-2">
          <dt id="section-9.3-2.1">Type name:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.2">
            <p id="section-9.3-2.2.1">message<a href="#section-9.3-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.3">Subtype name:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.4">
            <p id="section-9.3-2.4.1">ohttp-res<a href="#section-9.3-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.5">Required parameters:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.6">
            <p id="section-9.3-2.6.1">N/A<a href="#section-9.3-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.7">Optional parameters:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.8">
            <p id="section-9.3-2.8.1">N/A<a href="#section-9.3-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.9">Encoding considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.10">
            <p id="section-9.3-2.10.1">"binary"<a href="#section-9.3-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.11">Security considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.12">
            <p id="section-9.3-2.12.1">see <a href="#sec-media" class="auto internal xref">Section 6.9</a><a href="#section-9.3-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.13">Interoperability considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.14">
            <p id="section-9.3-2.14.1">N/A<a href="#section-9.3-2.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.15">Published specification:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.16">
            <p id="section-9.3-2.16.1">this specification<a href="#section-9.3-2.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.17">Applications that use this media type:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.18">
            <p id="section-9.3-2.18.1">Oblivious HTTP and applications that use Oblivious HTTP use this media type to
identify encapsulated binary HTTP responses.<a href="#section-9.3-2.18.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.19">Fragment identifier considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.20">
            <p id="section-9.3-2.20.1">N/A<a href="#section-9.3-2.20.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.21">Additional information:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.22">
            <span class="break"></span><dl class="dlCompact dlParallel" id="section-9.3-2.22.1">
              <dt id="section-9.3-2.22.1.1">Magic number(s):</dt>
              <dd style="margin-left: 1.5em" id="section-9.3-2.22.1.2">N/A<a href="#section-9.3-2.22.1.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.3-2.22.1.3">Deprecated alias names for this type:</dt>
              <dd style="margin-left: 1.5em" id="section-9.3-2.22.1.4">N/A<a href="#section-9.3-2.22.1.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.3-2.22.1.5">File extension(s):</dt>
              <dd style="margin-left: 1.5em" id="section-9.3-2.22.1.6">N/A<a href="#section-9.3-2.22.1.6" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.3-2.22.1.7">Macintosh file type code(s):</dt>
              <dd style="margin-left: 1.5em" id="section-9.3-2.22.1.8">N/A<a href="#section-9.3-2.22.1.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.23">Person and email address to contact for further information:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.24">
            <p id="section-9.3-2.24.1">see Authors' Addresses section<a href="#section-9.3-2.24.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.25">Intended usage:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.26">
            <p id="section-9.3-2.26.1">COMMON<a href="#section-9.3-2.26.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.27">Restrictions on usage:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.28">
            <p id="section-9.3-2.28.1">N/A<a href="#section-9.3-2.28.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.29">Author:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.30">
            <p id="section-9.3-2.30.1">see Authors' Addresses section<a href="#section-9.3-2.30.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.31">Change controller:</dt>
          <dd style="margin-left: 1.5em" id="section-9.3-2.32">
            <p id="section-9.3-2.32.1">IETF<a href="#section-9.3-2.32.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-problem-date">
<section id="section-9.4">
        <h3 id="name-registration-of-date-proble">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-registration-of-date-proble" class="section-name selfRef">Registration of "date" Problem Type</a>
        </h3>
<p id="section-9.4-1">IANA are requested to create a new entry in the "HTTP Problem Type" registry
established by <span>[<a href="#PROBLEM" class="cite xref">PROBLEM</a>]</span>.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.4-2">
          <dt id="section-9.4-2.1">Type URI:</dt>
          <dd style="margin-left: 1.5em" id="section-9.4-2.2">
            <p id="section-9.4-2.2.1">https://iana.org/assignments/http-problem-types#date<a href="#section-9.4-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.4-2.3">Title:</dt>
          <dd style="margin-left: 1.5em" id="section-9.4-2.4">
            <p id="section-9.4-2.4.1">Date Not Acceptable<a href="#section-9.4-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.4-2.5">Recommended HTTP Status Code:</dt>
          <dd style="margin-left: 1.5em" id="section-9.4-2.6">
            <p id="section-9.4-2.6.1">400<a href="#section-9.4-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.4-2.7">Reference:</dt>
          <dd style="margin-left: 1.5em" id="section-9.4-2.8">
            <p id="section-9.4-2.8.1"><a href="#date-fix" class="auto internal xref">Section 6.5.2</a> of this document<a href="#section-9.4-2.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-problem-ohttp-key">
<section id="section-9.5">
        <h3 id="name-registration-of-ohttp-key-p">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-registration-of-ohttp-key-p" class="section-name selfRef">Registration of "ohttp-key" Problem Type</a>
        </h3>
<p id="section-9.5-1">IANA are requested to create a new entry in the "HTTP Problem Type" registry
established by <span>[<a href="#PROBLEM" class="cite xref">PROBLEM</a>]</span>.<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.5-2">
          <dt id="section-9.5-2.1">Type URI:</dt>
          <dd style="margin-left: 1.5em" id="section-9.5-2.2">
            <p id="section-9.5-2.2.1">https://iana.org/assignments/http-problem-types#ohttp-key<a href="#section-9.5-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.5-2.3">Title:</dt>
          <dd style="margin-left: 1.5em" id="section-9.5-2.4">
            <p id="section-9.5-2.4.1">Oblivious HTTP <span id="iref-key-configuration-435" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> not acceptable<a href="#section-9.5-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.5-2.5">Recommended HTTP Status Code:</dt>
          <dd style="margin-left: 1.5em" id="section-9.5-2.6">
            <p id="section-9.5-2.6.1">400<a href="#section-9.5-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.5-2.7">Reference:</dt>
          <dd style="margin-left: 1.5em" id="section-9.5-2.8">
            <p id="section-9.5-2.8.1"><a href="#ohttp-key-problem" class="auto internal xref">Section 5.3</a> of this document<a href="#section-9.5-2.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="ASCII">[ASCII]</dt>
        <dd>
<span class="refAuthor">Cerf, V.</span>, <span class="refTitle">"ASCII format for network interchange"</span>, <span class="seriesInfo">STD 80</span>, <span class="seriesInfo">RFC 20</span>, <span class="seriesInfo">DOI 10.17487/RFC0020</span>, <time datetime="1969-10" class="refDate">October 1969</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc20">https://www.rfc-editor.org/rfc/rfc20</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BINARY">[BINARY]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Binary Representation of HTTP Messages"</span>, <span class="seriesInfo">RFC 9292</span>, <span class="seriesInfo">DOI 10.17487/RFC9292</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9292">https://www.rfc-editor.org/rfc/rfc9292</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HPKE">[HPKE]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP">[HTTP]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9110">https://www.rfc-editor.org/rfc/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP-CACHING">[HTTP-CACHING]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Caching"</span>, <span class="seriesInfo">STD 98</span>, <span class="seriesInfo">RFC 9111</span>, <span class="seriesInfo">DOI 10.17487/RFC9111</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9111">https://www.rfc-editor.org/rfc/rfc9111</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="PROBLEM">[PROBLEM]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refAuthor">Wilde, E.</span>, and <span class="refAuthor">S. Dalal</span>, <span class="refTitle">"Problem Details for HTTP APIs"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-httpapi-rfc7807bis-07</span>, <time datetime="2023-04-28" class="refDate">28 April 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-httpapi-rfc7807bis-07">https://datatracker.ietf.org/doc/html/draft-ietf-httpapi-rfc7807bis-07</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC">[QUIC]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9000">https://www.rfc-editor.org/rfc/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6838">[RFC6838]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span>, <span class="refAuthor">Klensin, J.</span>, and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"Media Type Specifications and Registration Procedures"</span>, <span class="seriesInfo">BCP 13</span>, <span class="seriesInfo">RFC 6838</span>, <span class="seriesInfo">DOI 10.17487/RFC6838</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6838">https://www.rfc-editor.org/rfc/rfc6838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8470">[RFC8470]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">W. Tarreau</span>, <span class="refTitle">"Using Early Data in HTTP"</span>, <span class="seriesInfo">RFC 8470</span>, <span class="seriesInfo">DOI 10.17487/RFC8470</span>, <time datetime="2018-09" class="refDate">September 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8470">https://www.rfc-editor.org/rfc/rfc8470</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS">[TLS]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="CLOCKSKEW">[CLOCKSKEW]</dt>
        <dd>
<span class="refAuthor">Acer, M.</span>, <span class="refAuthor">Stark, E.</span>, <span class="refAuthor">Felt, A.</span>, <span class="refAuthor">Fahl, S.</span>, <span class="refAuthor">Bhargava, R.</span>, <span class="refAuthor">Dev, B.</span>, <span class="refAuthor">Braithwaite, M.</span>, <span class="refAuthor">Sleevi, R.</span>, and <span class="refAuthor">P. Tabriz</span>, <span class="refTitle">"Where the Wild Warnings Are: Root Causes of Chrome HTTPS Certificate Errors"</span>, <span class="refContent">ACM</span>, <span class="seriesInfo">Proceedings of the 2017 ACM SIGSAC Conference on Computer and Communications Security</span>, <span class="seriesInfo">DOI 10.1145/3133956.3134007</span>, <time datetime="2017-10" class="refDate">October 2017</time>, <span>&lt;<a href="https://doi.org/10.1145/3133956.3134007">https://doi.org/10.1145/3133956.3134007</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CONSISTENCY">[CONSISTENCY]</dt>
        <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Finkel, M.</span>, <span class="refAuthor">Thomson, M.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Key Consistency and Discovery"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-key-consistency-01</span>, <time datetime="2023-07-10" class="refDate">10 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-key-consistency-01">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-key-consistency-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="COOKIES">[COOKIES]</dt>
        <dd>
<span class="refAuthor">Barth, A.</span>, <span class="refTitle">"HTTP State Management Mechanism"</span>, <span class="seriesInfo">RFC 6265</span>, <span class="seriesInfo">DOI 10.17487/RFC6265</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6265">https://www.rfc-editor.org/rfc/rfc6265</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DMS2004">[DMS2004]</dt>
        <dd>
<span class="refAuthor">Dingledine, R.</span>, <span class="refAuthor">Mathewson, N.</span>, and <span class="refAuthor">P. Syverson</span>, <span class="refTitle">"Tor: The Second-Generation Onion Router"</span>, <time datetime="2004-08" class="refDate">August 2004</time>, <span>&lt;<a href="https://svn.torproject.org/svn/projects/design-paper/tor-design.html">https://svn.torproject.org/svn/projects/design-paper/tor-design.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="FIELDING">[FIELDING]</dt>
        <dd>
<span class="refAuthor">Fielding, R. T.</span>, <span class="refTitle">"Architectural Styles and the Design of Network-based Software Architectures"</span>, <time datetime="2000" class="refDate">2000</time>, <span>&lt;<a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf">https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="FORWARDED">[FORWARDED]</dt>
        <dd>
<span class="refAuthor">Petersson, A.</span> and <span class="refAuthor">M. Nilsson</span>, <span class="refTitle">"Forwarded HTTP Extension"</span>, <span class="seriesInfo">RFC 7239</span>, <span class="seriesInfo">DOI 10.17487/RFC7239</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7239">https://www.rfc-editor.org/rfc/rfc7239</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP11">[HTTP/1.1]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP/1.1"</span>, <span class="seriesInfo">STD 99</span>, <span class="seriesInfo">RFC 9112</span>, <span class="seriesInfo">DOI 10.17487/RFC9112</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9112">https://www.rfc-editor.org/rfc/rfc9112</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP2">[HTTP/2]</dt>
        <dd>
<span class="refAuthor">Thomson, M., Ed.</span> and <span class="refAuthor">C. Benfield, Ed.</span>, <span class="refTitle">"HTTP/2"</span>, <span class="seriesInfo">RFC 9113</span>, <span class="seriesInfo">DOI 10.17487/RFC9113</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9113">https://www.rfc-editor.org/rfc/rfc9113</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP3">[HTTP/3]</dt>
        <dd>
<span class="refAuthor">Bishop, M., Ed.</span>, <span class="refTitle">"HTTP/3"</span>, <span class="seriesInfo">RFC 9114</span>, <span class="seriesInfo">DOI 10.17487/RFC9114</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9114">https://www.rfc-editor.org/rfc/rfc9114</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NTP">[NTP]</dt>
        <dd>
<span class="refAuthor">Mills, D.</span>, <span class="refAuthor">Martin, J., Ed.</span>, <span class="refAuthor">Burbank, J.</span>, and <span class="refAuthor">W. Kasch</span>, <span class="refTitle">"Network Time Protocol Version 4: Protocol and Algorithms Specification"</span>, <span class="seriesInfo">RFC 5905</span>, <span class="seriesInfo">DOI 10.17487/RFC5905</span>, <time datetime="2010-06" class="refDate">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5905">https://www.rfc-editor.org/rfc/rfc5905</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ODOH">[ODOH]</dt>
        <dd>
<span class="refAuthor">Kinnear, E.</span>, <span class="refAuthor">McManus, P.</span>, <span class="refAuthor">Pauly, T.</span>, <span class="refAuthor">Verma, T.</span>, and <span class="refAuthor">C.A. Wood</span>, <span class="refTitle">"Oblivious DNS over HTTPS"</span>, <span class="seriesInfo">RFC 9230</span>, <span class="seriesInfo">DOI 10.17487/RFC9230</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9230">https://www.rfc-editor.org/rfc/rfc9230</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ODOH-PETS">[ODOH-PETS]</dt>
        <dd>
<span class="refAuthor">Singanamalla, S.</span>, <span class="refAuthor">Chunhapanya, S.</span>, <span class="refAuthor">Vavrusa, M.</span>, <span class="refAuthor">Verma, T.</span>, <span class="refAuthor">Wu, P.</span>, <span class="refAuthor">Fayed, M.</span>, <span class="refAuthor">Heimerl, K.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious DNS over HTTPS (ODoH): A Practical Privacy Enhancement to DNS"</span>, <time datetime="2021-01-07" class="refDate">7 January 2021</time>, <span>&lt;<a href="https://www.petsymposium.org/2021/files/papers/issue4/popets-2021-0085.pdf">https://www.petsymposium.org/2021/files/papers/issue4/popets-2021-0085.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OHTTP-ANALYSIS">[OHTTP-ANALYSIS]</dt>
        <dd>
<span class="refAuthor">Hoyland, J.</span>, <span class="refTitle">"Tamarin Model of Oblivious HTTP"</span>, <time datetime="2021-08-23" class="refDate">23 August 2021</time>, <span>&lt;<a href="https://github.com/cloudflare/ohttp-analysis">https://github.com/cloudflare/ohttp-analysis</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="PRIO">[PRIO]</dt>
        <dd>
<span class="refAuthor">Corrigan-Gibbs, H.</span> and <span class="refAuthor">D. Boneh</span>, <span class="refTitle">"Prio: Private, Robust, and Scalable Computation of Aggregate Statistics"</span>, <time datetime="2017-03-14" class="refDate">14 March 2017</time>, <span>&lt;<a href="https://crypto.stanford.edu/prio/paper.pdf">https://crypto.stanford.edu/prio/paper.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RANDOM">[RANDOM]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refAuthor">Schiller, J.</span>, and <span class="refAuthor">S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4086">https://www.rfc-editor.org/rfc/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7838">[RFC7838]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refAuthor">McManus, P.</span>, and <span class="refAuthor">J. Reschke</span>, <span class="refTitle">"HTTP Alternative Services"</span>, <span class="seriesInfo">RFC 7838</span>, <span class="seriesInfo">DOI 10.17487/RFC7838</span>, <time datetime="2016-04" class="refDate">April 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7838">https://www.rfc-editor.org/rfc/rfc7838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8484">[RFC8484]</dt>
        <dd>
<span class="refAuthor">Hoffman, P.</span> and <span class="refAuthor">P. McManus</span>, <span class="refTitle">"DNS Queries over HTTPS (DoH)"</span>, <span class="seriesInfo">RFC 8484</span>, <span class="seriesInfo">DOI 10.17487/RFC8484</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8484">https://www.rfc-editor.org/rfc/rfc8484</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TEMPLATE">[TEMPLATE]</dt>
        <dd>
<span class="refAuthor">Gregorio, J.</span>, <span class="refAuthor">Fielding, R.</span>, <span class="refAuthor">Hadley, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">D. Orchard</span>, <span class="refTitle">"URI Template"</span>, <span class="seriesInfo">RFC 6570</span>, <span class="seriesInfo">DOI 10.17487/RFC6570</span>, <time datetime="2012-03" class="refDate">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6570">https://www.rfc-editor.org/rfc/rfc6570</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="UWT">[UWT]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Unsanctioned Web Tracking"</span>, <time datetime="2015-07-17" class="refDate">17 July 2015</time>, <span>&lt;<a href="https://www.w3.org/2001/tag/doc/unsanctioned-tracking/">https://www.w3.org/2001/tag/doc/unsanctioned-tracking/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="X25519">[X25519]</dt>
      <dd>
<span class="refAuthor">Langley, A.</span>, <span class="refAuthor">Hamburg, M.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7748">https://www.rfc-editor.org/rfc/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="complete-example-of-a-request-and-response">
<section id="appendix-A">
      <h2 id="name-complete-example-of-a-reque">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-complete-example-of-a-reque" class="section-name selfRef">Complete Example of a Request and Response</a>
      </h2>
<p id="appendix-A-1">A single request and response exchange is shown here. Binary values (<span id="iref-key-configuration-436" class="iref"></span><a href="#key-configuration" class="internal xref">key
configuration</a>, secret keys, the content of messages, and intermediate values)
are shown in hexadecimal. The request and response here are minimal; the purpose
of this example is to show the cryptographic operations.  In this example, the
<span id="iref-client-437" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> is configured with the <span id="iref-oblivious-relay-resource-43" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> URI of
<code>https://proxy.example.org/request.example.net/proxy</code>, and the proxy is
configured to map requests to this URI to the <span id="iref-oblivious-gateway-resource-43" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> URI
<code>https://example.com/oblivious/request</code>. The <span id="iref-target-resource-440" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a> URI, i.e., the
resource the <span id="iref-client-441" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> ultimately wishes to query, is <code>https://example.com</code>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">To begin the process, the <span id="iref-oblivious-gateway-resource-44" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> generates a key pair.
In this example the server chooses DHKEM(X25519, HKDF-SHA256) and generates
an X25519 key pair <span>[<a href="#X25519" class="cite xref">X25519</a>]</span>. The X25519 secret key is:<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-3">
<pre>
3c168975674b2fa8e465970b79c8dcf09f1c741626480bd4c6162fc5b6a98e1a
</pre><a href="#appendix-A-3" class="pilcrow">¶</a>
</div>
<p id="appendix-A-4">The <span id="iref-oblivious-gateway-resource-443" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> constructs a <span id="iref-key-configuration-444" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> that includes the
corresponding public key as follows:<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-5">
<pre>
01002031e1f05a740102115220e9af918f738674aec95f54db6e04eb705aae8e
79815500080001000100010003
</pre><a href="#appendix-A-5" class="pilcrow">¶</a>
</div>
<p id="appendix-A-6">This <span id="iref-key-configuration-445" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> is somehow obtained by the <span id="iref-client-446" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>. Then, when a <span id="iref-client-447" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a>
wishes to send an HTTP GET request to the target <code>https://example.com</code>, it
constructs the following binary HTTP message:<a href="#appendix-A-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-7">
<pre>
00034745540568747470730b6578616d706c652e636f6d012f
</pre><a href="#appendix-A-7" class="pilcrow">¶</a>
</div>
<p id="appendix-A-8">The <span id="iref-client-448" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> then reads the <span id="iref-oblivious-gateway-resource-449" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> <span id="iref-key-configuration-450" class="iref"></span><a href="#key-configuration" class="internal xref">key configuration</a> and
selects a mutually supported KDF and AEAD. In this example, the <span id="iref-client-451" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> selects
HKDF-SHA256 and AES-128-GCM. The <span id="iref-client-452" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> then generates an HPKE sending context
that uses the server public key. This context is constructed from the following
ephemeral secret key:<a href="#appendix-A-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-9">
<pre>
bc51d5e930bda26589890ac7032f70ad12e4ecb37abb1b65b1256c9c48999c73
</pre><a href="#appendix-A-9" class="pilcrow">¶</a>
</div>
<p id="appendix-A-10">The corresponding public key is:<a href="#appendix-A-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-11">
<pre>
4b28f881333e7c164ffc499ad9796f877f4e1051ee6d31bad19dec96c208b472
</pre><a href="#appendix-A-11" class="pilcrow">¶</a>
</div>
<p id="appendix-A-12">And an <code>info</code> parameter of:<a href="#appendix-A-12" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-13">
<pre>
6d6573736167652f626874747020726571756573740001002000010001
</pre><a href="#appendix-A-13" class="pilcrow">¶</a>
</div>
<p id="appendix-A-14">Applying the Seal operation from the HPKE context produces an encrypted
message, allowing the <span id="iref-client-453" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> to construct the following <span id="iref-encapsulated-request-454" class="iref"></span><a href="#dfn-enc-req" class="internal xref">Encapsulated Request</a>:<a href="#appendix-A-14" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-15">
<pre>
010020000100014b28f881333e7c164ffc499ad9796f877f4e1051ee6d31bad1
9dec96c208b4726374e469135906992e1268c594d2a10c695d858c40a026e796
5e7d86b83dd440b2c0185204b4d63525
</pre><a href="#appendix-A-15" class="pilcrow">¶</a>
</div>
<p id="appendix-A-16">The <span id="iref-client-455" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> then sends this to the <span id="iref-oblivious-relay-resource-45" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> in a POST request,
which might look like the following HTTP/1.1 request:<a href="#appendix-A-16" class="pilcrow">¶</a></p>
<div class="lang-http-message sourcecode" id="appendix-A-17">
<pre>
POST /request.example.net/proxy HTTP/1.1
Host: proxy.example.org
Content-Type: message/ohttp-req
Content-Length: 78

&lt;content is the Encapsulated Request above&gt;
</pre><a href="#appendix-A-17" class="pilcrow">¶</a>
</div>
<p id="appendix-A-18">The <span id="iref-oblivious-relay-resource-457" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> receives this request and forwards it to the
<span id="iref-oblivious-gateway-resource-45" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a>, which might look like:<a href="#appendix-A-18" class="pilcrow">¶</a></p>
<div class="lang-http-message sourcecode" id="appendix-A-19">
<pre>
POST /oblivious/request HTTP/1.1
Host: example.com
Content-Type: message/ohttp-req
Content-Length: 78

&lt;content is the Encapsulated Request above&gt;
</pre><a href="#appendix-A-19" class="pilcrow">¶</a>
</div>
<p id="appendix-A-20">The <span id="iref-oblivious-gateway-resource-459" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> receives this request, selects the key it
generated previously using the key identifier from the message, and decrypts the
message. As this request is directed to the same server, the <span id="iref-oblivious-gateway-resource-460" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway
Resource</a> does not need to initiate an HTTP request to the <span id="iref-target-resource-461" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>. The
request can be served directly by the <span id="iref-target-resource-462" class="iref"></span><a href="#dfn-target" class="internal xref">Target Resource</a>, which generates a minimal
response (consisting of just a 200 status code) as follows:<a href="#appendix-A-20" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-21">
<pre>
0140c8
</pre><a href="#appendix-A-21" class="pilcrow">¶</a>
</div>
<p id="appendix-A-22">The response is constructed by exporting a secret from the HPKE context:<a href="#appendix-A-22" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-23">
<pre>
62d87a6ba569ee81014c2641f52bea36
</pre><a href="#appendix-A-23" class="pilcrow">¶</a>
</div>
<p id="appendix-A-24">The key derivation for the <span id="iref-encapsulated-response-463" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a> uses both the encapsulated KEM
key from the request and a randomly selected nonce. This produces a salt of:<a href="#appendix-A-24" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-25">
<pre>
4b28f881333e7c164ffc499ad9796f877f4e1051ee6d31bad19dec96c208b472
c789e7151fcba46158ca84b04464910d
</pre><a href="#appendix-A-25" class="pilcrow">¶</a>
</div>
<p id="appendix-A-26">The salt and secret are both passed to the Extract function of the selected KDF
(HKDF-SHA256) to produce a pseudorandom key of:<a href="#appendix-A-26" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-27">
<pre>
979aaeae066cf211ab407b31ae49767f344e1501e475c84e8aff547cc5a683db
</pre><a href="#appendix-A-27" class="pilcrow">¶</a>
</div>
<p id="appendix-A-28">The pseudorandom key is used with the Expand function of the KDF and an info
field of "key" to produce a 16-byte key for the selected AEAD (AES-128-GCM):<a href="#appendix-A-28" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-29">
<pre>
5d0172a080e428b16d298c4ea0db620d
</pre><a href="#appendix-A-29" class="pilcrow">¶</a>
</div>
<p id="appendix-A-30">With the same KDF and pseudorandom key, an info field of "nonce" is used to
generate a 12-byte nonce:<a href="#appendix-A-30" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-31">
<pre>
f6bf1aeb88d6df87007fa263
</pre><a href="#appendix-A-31" class="pilcrow">¶</a>
</div>
<p id="appendix-A-32">The AEAD <code>Seal()</code> function is then used to encrypt the response, which is added
to the randomized nonce value to produce the <span id="iref-encapsulated-response-464" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a>:<a href="#appendix-A-32" class="pilcrow">¶</a></p>
<div class="alignLeft art-hex-dump art-text artwork" id="appendix-A-33">
<pre>
c789e7151fcba46158ca84b04464910d86f9013e404feea014e7be4a441f234f
857fbd
</pre><a href="#appendix-A-33" class="pilcrow">¶</a>
</div>
<p id="appendix-A-34">The <span id="iref-oblivious-gateway-resource-465" class="iref"></span><a href="#dfn-gateway" class="internal xref">Oblivious Gateway Resource</a> constructs a response with the same content:<a href="#appendix-A-34" class="pilcrow">¶</a></p>
<div class="lang-http-message sourcecode" id="appendix-A-35">
<pre>
HTTP/1.1 200 OK
Date: Wed, 27 Jan 2021 04:45:07 GMT
Cache-Control: private, no-store
Content-Type: message/ohttp-res
Content-Length: 38

&lt;content is the Encapsulated Response&gt;
</pre><a href="#appendix-A-35" class="pilcrow">¶</a>
</div>
<p id="appendix-A-36">The same response might then be generated by the <span id="iref-oblivious-relay-resource-46" class="iref"></span><a href="#dfn-relay" class="internal xref">Oblivious Relay Resource</a> which
might change as little as the Date header. The <span id="iref-client-467" class="iref"></span><a href="#dfn-client" class="internal xref">Client</a> is then able to use the
HPKE context it created and the nonce from the <span id="iref-encapsulated-response-468" class="iref"></span><a href="#dfn-enc-res" class="internal xref">Encapsulated Response</a> to
construct the AEAD key and nonce and decrypt the response.<a href="#appendix-A-36" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-B">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-B-1">This design is based on a design for Oblivious DoH, described in
<span>[<a href="#ODOH" class="cite xref">ODOH</a>]</span>. <span class="contact-name">David Benjamin</span>, <span class="contact-name">Mark Nottingham</span>, and <span class="contact-name">Eric Rescorla</span> made technical contributions.  The authors also thank <span class="contact-name">Ralph Giles</span>, <span class="contact-name">Lucas Pardue</span>, and <span class="contact-name">Tommy Pauly</span> for invaluable assistance.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="appendix-C">
      <h2 id="name-index">
<a href="#name-index" class="section-name selfRef">Index</a>
      </h2>
<div id="rfc.index.index">
<p id="appendix-C-1">
        <a href="#rfc.index.u67" class="internal xref">C</a>
        <a href="#rfc.index.u69" class="internal xref">E</a>
        <a href="#rfc.index.u75" class="internal xref">K</a>
        <a href="#rfc.index.u79" class="internal xref">O</a>
        <a href="#rfc.index.u84" class="internal xref">T</a><a href="#appendix-C-1" class="pilcrow">¶</a></p>
</div>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="appendix-C-2.1">
          <div id="rfc.index.u67">
<p id="appendix-C-2.1.1" class="keepWithNext">
            <a href="#rfc.index.u67" class="internal xref">C</a><a href="#appendix-C-2.1.1" class="pilcrow">¶</a></p>
</div>
<ul class="compact normal ulEmpty">
<li class="compact normal ulEmpty" id="appendix-C-2.1.2.1">
              <span class="break"></span><dl class="dlCompact dlParallel" id="appendix-C-2.1.2.1.1">
                <dt id="appendix-C-2.1.2.1.1.1">Client</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.1.2.1.1.2">
                  <p id="appendix-C-2.1.2.1.1.2.1">
                    <a href="#section-2-1" class="auto internal xref">Section 2, Paragraph 1</a>; 
<a href="#section-2-3" class="auto internal xref">Section 2, Paragraph 3</a>; 
<a href="#section-2-3" class="auto internal xref">Section 2, Paragraph 3</a>; 
<a href="#section-2-6.1.1" class="auto internal xref">Section 2, Paragraph 6.1.1</a>; 
<a href="#section-2-6.2.1" class="auto internal xref">Section 2, Paragraph 6.2.1</a>; 
<a href="#section-2-6.3.1" class="auto internal xref">Section 2, Paragraph 6.3.1</a>; 
<a href="#section-2-8.2.1" class="auto internal xref">Section 2, Paragraph 8.2.1</a>; 
<a href="#section-2-8.3.1" class="auto internal xref">Section 2, Paragraph 8.3.1</a>; 
<a href="#section-2-9" class="auto internal xref">Section 2, Paragraph 9</a>; 
<a href="#section-2-9" class="auto internal xref">Section 2, Paragraph 9</a>; 
<a href="#section-2-9" class="auto internal xref">Section 2, Paragraph 9</a>; 
<a href="#section-2.2-3.1" class="auto internal xref">Section 2.2</a>; 
<a href="#dfn-client" class="auto internal xref">Section 2.2, Paragraph 3.2.1</a>; 
<a href="#dfn-client" class="auto internal xref">Section 2.2, Paragraph 3.2.1</a>; 
<a href="#section-3-1" class="auto internal xref">Section 3, Paragraph 1</a>; 
<a href="#section-3-2" class="auto internal xref">Section 3, Paragraph 2</a>; 
<a href="#section-3-2" class="auto internal xref">Section 3, Paragraph 2</a>; 
<a href="#section-3-3" class="auto internal xref">Section 3, Paragraph 3</a>; 
<a href="#section-3.2-3" class="auto internal xref">Section 3.2, Paragraph 3</a>; 
<a href="#section-4.3-2.3.1" class="auto internal xref">Section 4.3, Paragraph 2.3.1</a>; 
<a href="#section-4.3-3" class="auto internal xref">Section 4.3, Paragraph 3</a>; 
<a href="#section-4.4-6" class="auto internal xref">Section 4.4, Paragraph 6</a>; 
<a href="#section-4.6-1" class="auto internal xref">Section 4.6, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-2" class="auto internal xref">Section 5, Paragraph 2</a>; 
<a href="#section-5-3" class="auto internal xref">Section 5, Paragraph 3</a>; 
<a href="#section-5-4" class="auto internal xref">Section 5, Paragraph 4</a>; 
<a href="#section-5-4" class="auto internal xref">Section 5, Paragraph 4</a>; 
<a href="#section-5-4" class="auto internal xref">Section 5, Paragraph 4</a>; 
<a href="#section-5-8" class="auto internal xref">Section 5, Paragraph 8</a>; 
<a href="#section-5.2-4" class="auto internal xref">Section 5.2, Paragraph 4</a>; 
<a href="#section-5.2-4" class="auto internal xref">Section 5.2, Paragraph 4</a>; 
<a href="#section-5.3-4" class="auto internal xref">Section 5.3, Paragraph 4</a>; 
<a href="#section-5.3-4" class="auto internal xref">Section 5.3, Paragraph 4</a>; 
<a href="#section-5.3-4" class="auto internal xref">Section 5.3, Paragraph 4</a>; 
<a href="#section-5.3-4" class="auto internal xref">Section 5.3, Paragraph 4</a>; 
<a href="#section-6-1" class="auto internal xref">Section 6, Paragraph 1</a>; 
<a href="#section-6-1" class="auto internal xref">Section 6, Paragraph 1</a>; 
<a href="#section-6-2.1.1" class="auto internal xref">Section 6, Paragraph 2.1.1</a>; 
<a href="#section-6-2.1.1" class="auto internal xref">Section 6, Paragraph 2.1.1</a>; 
<a href="#section-6-2.1.1" class="auto internal xref">Section 6, Paragraph 2.1.1</a>; 
<a href="#section-6-2.2.1" class="auto internal xref">Section 6, Paragraph 2.2.1</a>; 
<a href="#section-6-3" class="auto internal xref">Section 6, Paragraph 3</a>; 
<a href="#section-6-5.1.1" class="auto internal xref">Section 6, Paragraph 5.1.1</a>; 
<a href="#section-6-7" class="auto internal xref">Section 6, Paragraph 7</a>; 
<a href="#section-6-8" class="auto internal xref">Section 6, Paragraph 8</a>; 
<a href="#section-6-10.1.1" class="auto internal xref">Section 6, Paragraph 10.1.1</a>; 
<a href="#section-6-10.1.1" class="auto internal xref">Section 6, Paragraph 10.1.1</a>; 
<a href="#section-6-10.2.1" class="auto internal xref">Section 6, Paragraph 10.2.1</a>; 
<a href="#section-6-10.2.1" class="auto internal xref">Section 6, Paragraph 10.2.1</a>; 
<a href="#section-6.1-6" class="auto internal xref">Section 6.1, Paragraph 6</a>; 
<a href="#section-6.1-6" class="auto internal xref">Section 6.1, Paragraph 6</a>; 
<a href="#section-6.1-6" class="auto internal xref">Section 6.1, Paragraph 6</a>; 
<a href="#section-6.1-6" class="auto internal xref">Section 6.1, Paragraph 6</a>; 
<a href="#section-6.2-1" class="auto internal xref">Section 6.2, Paragraph 1</a>; 
<a href="#section-6.2-2" class="auto internal xref">Section 6.2, Paragraph 2</a>; 
<a href="#section-6.2-4" class="auto internal xref">Section 6.2, Paragraph 4</a>; 
<a href="#section-6.2-4" class="auto internal xref">Section 6.2, Paragraph 4</a>; 
<a href="#section-6.2.1-1" class="auto internal xref">Section 6.2.1, Paragraph 1</a>; 
<a href="#section-6.2.1-1" class="auto internal xref">Section 6.2.1, Paragraph 1</a>; 
<a href="#section-6.2.1-2" class="auto internal xref">Section 6.2.1, Paragraph 2</a>; 
<a href="#section-6.2.1-2" class="auto internal xref">Section 6.2.1, Paragraph 2</a>; 
<a href="#section-6.2.1-3" class="auto internal xref">Section 6.2.1, Paragraph 3</a>; 
<a href="#section-6.2.1-3" class="auto internal xref">Section 6.2.1, Paragraph 3</a>; 
<a href="#section-6.2.1-4" class="auto internal xref">Section 6.2.1, Paragraph 4</a>; 
<a href="#section-6.2.3-3" class="auto internal xref">Section 6.2.3, Paragraph 3</a>; 
<a href="#section-6.3-1" class="auto internal xref">Section 6.3, Paragraph 1</a>; 
<a href="#section-6.5-2" class="auto internal xref">Section 6.5, Paragraph 2</a>; 
<a href="#section-6.5-4" class="auto internal xref">Section 6.5, Paragraph 4</a>; 
<a href="#section-6.5-6" class="auto internal xref">Section 6.5, Paragraph 6</a>; 
<a href="#section-6.5.1-1" class="auto internal xref">Section 6.5.1, Paragraph 1</a>; 
<a href="#section-6.5.1-4" class="auto internal xref">Section 6.5.1, Paragraph 4</a>; 
<a href="#section-6.5.2-4" class="auto internal xref">Section 6.5.2, Paragraph 4</a>; 
<a href="#section-6.5.2-5" class="auto internal xref">Section 6.5.2, Paragraph 5</a>; 
<a href="#section-6.5.2-5" class="auto internal xref">Section 6.5.2, Paragraph 5</a>; 
<a href="#section-6.5.2-7" class="auto internal xref">Section 6.5.2, Paragraph 7</a>; 
<a href="#section-6.5.2-7" class="auto internal xref">Section 6.5.2, Paragraph 7</a>; 
<a href="#section-6.7-2" class="auto internal xref">Section 6.7, Paragraph 2</a>; 
<a href="#section-6.7-2" class="auto internal xref">Section 6.7, Paragraph 2</a>; 
<a href="#section-6.7-4" class="auto internal xref">Section 6.7, Paragraph 4</a>; 
<a href="#section-6.8-1" class="auto internal xref">Section 6.8, Paragraph 1</a>; 
<a href="#section-6.9-1" class="auto internal xref">Section 6.9, Paragraph 1</a>; 
<a href="#section-7-1" class="auto internal xref">Section 7, Paragraph 1</a>; 
<a href="#section-7-1" class="auto internal xref">Section 7, Paragraph 1</a>; 
<a href="#section-7-1" class="auto internal xref">Section 7, Paragraph 1</a>; 
<a href="#section-7-3" class="auto internal xref">Section 7, Paragraph 3</a>; 
<a href="#section-7-3" class="auto internal xref">Section 7, Paragraph 3</a>; 
<a href="#section-7-4" class="auto internal xref">Section 7, Paragraph 4</a>; 
<a href="#section-7-4" class="auto internal xref">Section 7, Paragraph 4</a>; 
<a href="#section-7-5" class="auto internal xref">Section 7, Paragraph 5</a>; 
<a href="#section-7-5" class="auto internal xref">Section 7, Paragraph 5</a>; 
<a href="#section-7-5" class="auto internal xref">Section 7, Paragraph 5</a>; 
<a href="#section-7-6" class="auto internal xref">Section 7, Paragraph 6</a>; 
<a href="#appendix-A-1" class="auto internal xref">Appendix A, Paragraph 1</a>; 
<a href="#appendix-A-1" class="auto internal xref">Appendix A, Paragraph 1</a>; 
<a href="#appendix-A-6" class="auto internal xref">Appendix A, Paragraph 6</a>; 
<a href="#appendix-A-6" class="auto internal xref">Appendix A, Paragraph 6</a>; 
<a href="#appendix-A-8" class="auto internal xref">Appendix A, Paragraph 8</a>; 
<a href="#appendix-A-8" class="auto internal xref">Appendix A, Paragraph 8</a>; 
<a href="#appendix-A-8" class="auto internal xref">Appendix A, Paragraph 8</a>; 
<a href="#appendix-A-14" class="auto internal xref">Appendix A, Paragraph 14</a>; 
<a href="#appendix-A-16" class="auto internal xref">Appendix A, Paragraph 16</a>; 
<a href="#appendix-A-36" class="auto internal xref">Appendix A, Paragraph 36</a><a href="#appendix-C-2.1.2.1.1.2.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="appendix-C-2.1.2.1.1.3">Clients</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.1.2.1.1.4">
                  <p id="appendix-C-2.1.2.1.1.4.1">
                    <a href="#section-1-6" class="auto internal xref">Section 1, Paragraph 6</a>; 
<a href="#dfn-relay" class="auto internal xref">Section 2.2, Paragraph 3.8.1</a>; 
<a href="#section-3-1" class="auto internal xref">Section 3, Paragraph 1</a>; 
<a href="#section-3-3" class="auto internal xref">Section 3, Paragraph 3</a>; 
<a href="#section-3-3" class="auto internal xref">Section 3, Paragraph 3</a>; 
<a href="#section-3.2-3" class="auto internal xref">Section 3.2, Paragraph 3</a>; 
<a href="#section-3.2-3" class="auto internal xref">Section 3.2, Paragraph 3</a>; 
<a href="#section-4.3-1" class="auto internal xref">Section 4.3, Paragraph 1</a>; 
<a href="#section-4.4-5" class="auto internal xref">Section 4.4, Paragraph 5</a>; 
<a href="#section-4.4-5" class="auto internal xref">Section 4.4, Paragraph 5</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-2" class="auto internal xref">Section 5, Paragraph 2</a>; 
<a href="#section-5.1-2" class="auto internal xref">Section 5.1, Paragraph 2</a>; 
<a href="#section-6-10.1.1" class="auto internal xref">Section 6, Paragraph 10.1.1</a>; 
<a href="#section-6.1-1" class="auto internal xref">Section 6.1, Paragraph 1</a>; 
<a href="#section-6.1-1" class="auto internal xref">Section 6.1, Paragraph 1</a>; 
<a href="#section-6.1-2" class="auto internal xref">Section 6.1, Paragraph 2</a>; 
<a href="#section-6.1-3" class="auto internal xref">Section 6.1, Paragraph 3</a>; 
<a href="#section-6.1-3" class="auto internal xref">Section 6.1, Paragraph 3</a>; 
<a href="#section-6.1-4" class="auto internal xref">Section 6.1, Paragraph 4</a>; 
<a href="#section-6.1-4" class="auto internal xref">Section 6.1, Paragraph 4</a>; 
<a href="#section-6.1-5" class="auto internal xref">Section 6.1, Paragraph 5</a>; 
<a href="#section-6.1-7" class="auto internal xref">Section 6.1, Paragraph 7</a>; 
<a href="#section-6.2-3" class="auto internal xref">Section 6.2, Paragraph 3</a>; 
<a href="#section-6.2-4" class="auto internal xref">Section 6.2, Paragraph 4</a>; 
<a href="#section-6.2.1-1" class="auto internal xref">Section 6.2.1, Paragraph 1</a>; 
<a href="#section-6.2.1-1" class="auto internal xref">Section 6.2.1, Paragraph 1</a>; 
<a href="#section-6.2.1-3" class="auto internal xref">Section 6.2.1, Paragraph 3</a>; 
<a href="#section-6.2.1-3" class="auto internal xref">Section 6.2.1, Paragraph 3</a>; 
<a href="#section-6.2.1-3" class="auto internal xref">Section 6.2.1, Paragraph 3</a>; 
<a href="#section-6.2.1-3" class="auto internal xref">Section 6.2.1, Paragraph 3</a>; 
<a href="#section-6.2.2-2" class="auto internal xref">Section 6.2.2, Paragraph 2</a>; 
<a href="#section-6.2.3-3" class="auto internal xref">Section 6.2.3, Paragraph 3</a>; 
<a href="#section-6.2.3-5" class="auto internal xref">Section 6.2.3, Paragraph 5</a>; 
<a href="#section-6.2.3-5" class="auto internal xref">Section 6.2.3, Paragraph 5</a>; 
<a href="#section-6.2.3-6" class="auto internal xref">Section 6.2.3, Paragraph 6</a>; 
<a href="#section-6.5-1" class="auto internal xref">Section 6.5, Paragraph 1</a>; 
<a href="#section-6.5.1-1" class="auto internal xref">Section 6.5.1, Paragraph 1</a>; 
<a href="#section-6.5.1-4" class="auto internal xref">Section 6.5.1, Paragraph 4</a>; 
<a href="#section-6.5.2-7" class="auto internal xref">Section 6.5.2, Paragraph 7</a>; 
<a href="#section-6.5.2-8" class="auto internal xref">Section 6.5.2, Paragraph 8</a>; 
<a href="#section-6.5.2-10" class="auto internal xref">Section 6.5.2, Paragraph 10</a>; 
<a href="#section-6.8-1" class="auto internal xref">Section 6.8, Paragraph 1</a>; 
<a href="#section-6.8-1" class="auto internal xref">Section 6.8, Paragraph 1</a>; 
<a href="#section-6.8-2" class="auto internal xref">Section 6.8, Paragraph 2</a>; 
<a href="#section-7-1" class="auto internal xref">Section 7, Paragraph 1</a>; 
<a href="#section-7-4" class="auto internal xref">Section 7, Paragraph 4</a>; 
<a href="#section-7-4" class="auto internal xref">Section 7, Paragraph 4</a>; 
<a href="#section-7-4" class="auto internal xref">Section 7, Paragraph 4</a>; 
<a href="#section-7-5" class="auto internal xref">Section 7, Paragraph 5</a>; 
<a href="#section-8.1-1" class="auto internal xref">Section 8.1, Paragraph 1</a>; 
<a href="#section-8.2-2" class="auto internal xref">Section 8.2, Paragraph 2</a>; 
<a href="#section-8.3-1" class="auto internal xref">Section 8.3, Paragraph 1</a>; 
<a href="#section-8.3-2" class="auto internal xref">Section 8.3, Paragraph 2</a><a href="#appendix-C-2.1.2.1.1.4.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ul>
</li>
        <li class="normal ulEmpty" id="appendix-C-2.2">
          <div id="rfc.index.u69">
<p id="appendix-C-2.2.1" class="keepWithNext">
            <a href="#rfc.index.u69" class="internal xref">E</a><a href="#appendix-C-2.2.1" class="pilcrow">¶</a></p>
</div>
<ul class="compact normal ulEmpty">
<li class="compact normal ulEmpty" id="appendix-C-2.2.2.1">
              <span class="break"></span><dl class="dlCompact dlParallel" id="appendix-C-2.2.2.1.1">
                <dt id="appendix-C-2.2.2.1.1.1">Encapsulated Request</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.2.2.1.1.2">
                  <p id="appendix-C-2.2.2.1.1.2.1">
                    <a href="#section-2-2.3.1" class="auto internal xref">Section 2, Paragraph 2.3.1</a>; 
<a href="#section-2-6.3.1" class="auto internal xref">Section 2, Paragraph 6.3.1</a>; 
<a href="#section-2-7" class="auto internal xref">Section 2, Paragraph 7</a>; 
<a href="#section-2.2-3.3" class="auto internal xref">Section 2.2</a>; 
<a href="#dfn-gateway" class="auto internal xref">Section 2.2, Paragraph 3.10.1</a>; 
<a href="#dfn-target" class="auto internal xref">Section 2.2, Paragraph 3.12.1</a>; 
<a href="#section-4-2.1.1" class="auto internal xref">Section 4, Paragraph 2.1.1</a>; 
<a href="#section-4.1-3" class="auto internal xref">Section 4.1, Paragraph 3</a>; 
<a href="#section-4.1-3" class="auto internal xref">Section 4.1, Paragraph 3</a>; 
<a href="#section-4.1-4" class="auto internal xref">Section 4.1, Paragraph 4</a>; 
<a href="#section-4.1-4" class="auto internal xref">Section 4.1, Paragraph 4</a>; 
<a href="#section-4.1-6" class="auto internal xref">Section 4.1, Paragraph 6</a>; 
<a href="#section-4.3-3" class="auto internal xref">Section 4.3, Paragraph 3</a>; 
<a href="#section-4.3-8" class="auto internal xref">Section 4.3, Paragraph 8</a>; 
<a href="#section-4.3-8" class="auto internal xref">Section 4.3, Paragraph 8</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5.2-3" class="auto internal xref">Section 5.2, Paragraph 3</a>; 
<a href="#section-5.3-1" class="auto internal xref">Section 5.3, Paragraph 1</a>; 
<a href="#section-6-3" class="auto internal xref">Section 6, Paragraph 3</a>; 
<a href="#section-6-10.1.1" class="auto internal xref">Section 6, Paragraph 10.1.1</a>; 
<a href="#section-6.1-6" class="auto internal xref">Section 6.1, Paragraph 6</a>; 
<a href="#section-6.2.3-2" class="auto internal xref">Section 6.2.3, Paragraph 2</a>; 
<a href="#section-6.3-2" class="auto internal xref">Section 6.3, Paragraph 2</a>; 
<a href="#section-6.4-2" class="auto internal xref">Section 6.4, Paragraph 2</a>; 
<a href="#section-6.5-2" class="auto internal xref">Section 6.5, Paragraph 2</a>; 
<a href="#section-6.10-2" class="auto internal xref">Section 6.10, Paragraph 2</a>; 
<a href="#appendix-A-14" class="auto internal xref">Appendix A, Paragraph 14</a><a href="#appendix-C-2.2.2.1.1.2.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="appendix-C-2.2.2.1.1.3">Encapsulated Response</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.2.2.1.1.4">
                  <p id="appendix-C-2.2.2.1.1.4.1">
                    <a href="#section-2.2-3.5" class="auto internal xref">Section 2.2</a>; 
<a href="#dfn-gateway" class="auto internal xref">Section 2.2, Paragraph 3.10.1</a>; 
<a href="#section-4-2.2.1" class="auto internal xref">Section 4, Paragraph 2.2.1</a>; 
<a href="#section-4.2-3" class="auto internal xref">Section 4.2, Paragraph 3</a>; 
<a href="#section-4.2-3" class="auto internal xref">Section 4.2, Paragraph 3</a>; 
<a href="#section-4.2-4" class="auto internal xref">Section 4.2, Paragraph 4</a>; 
<a href="#section-4.2-4" class="auto internal xref">Section 4.2, Paragraph 4</a>; 
<a href="#section-4.2-6" class="auto internal xref">Section 4.2, Paragraph 6</a>; 
<a href="#section-4.4-1" class="auto internal xref">Section 4.4, Paragraph 1</a>; 
<a href="#section-4.4-2.7.1" class="auto internal xref">Section 4.4, Paragraph 2.7.1</a>; 
<a href="#section-4.4-5" class="auto internal xref">Section 4.4, Paragraph 5</a>; 
<a href="#section-5.2-3" class="auto internal xref">Section 5.2, Paragraph 3</a>; 
<a href="#section-5.2-4" class="auto internal xref">Section 5.2, Paragraph 4</a>; 
<a href="#section-6.2-5" class="auto internal xref">Section 6.2, Paragraph 5</a>; 
<a href="#appendix-A-24" class="auto internal xref">Appendix A, Paragraph 24</a>; 
<a href="#appendix-A-32" class="auto internal xref">Appendix A, Paragraph 32</a>; 
<a href="#appendix-A-36" class="auto internal xref">Appendix A, Paragraph 36</a><a href="#appendix-C-2.2.2.1.1.4.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ul>
</li>
        <li class="normal ulEmpty" id="appendix-C-2.3">
          <div id="rfc.index.u75">
<p id="appendix-C-2.3.1" class="keepWithNext">
            <a href="#rfc.index.u75" class="internal xref">K</a><a href="#appendix-C-2.3.1" class="pilcrow">¶</a></p>
</div>
<ul class="compact normal ulEmpty">
<li class="compact normal ulEmpty" id="appendix-C-2.3.2.1">
              <span class="break"></span><dl class="dlCompact dlParallel" id="appendix-C-2.3.2.1.1">
                <dt id="appendix-C-2.3.2.1.1.1">key configuration</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.3.2.1.1.2">
                  <p id="appendix-C-2.3.2.1.1.2.1">
                    <a href="#section-3-1" class="auto internal xref">Section 3, Paragraph 1</a>; 
<a href="#section-3-1" class="auto internal xref">Section 3, Paragraph 1</a>; 
<a href="#section-3-2" class="auto internal xref">Section 3, Paragraph 2</a>; 
<a href="#section-3-3" class="auto internal xref">Section 3, Paragraph 3</a>; 
<a href="#section-3.1-1" class="auto internal xref">Section 3.1, Paragraph 1</a>; 
<a href="#section-3.1-2" class="auto internal xref">Section 3.1, Paragraph 2</a>; 
<a href="#section-3.1-4" class="auto internal xref">Section 3.1, Paragraph 4</a>; 
<a href="#section-3.2-1" class="auto internal xref">Section 3.2, Paragraph 1</a>; 
<a href="#section-3.2-1" class="auto internal xref">Section 3.2, Paragraph 1</a>; 
<a href="#section-3.2-2" class="auto internal xref">Section 3.2, Paragraph 2</a>; 
<a href="#section-3.2-3" class="auto internal xref">Section 3.2, Paragraph 3</a>; 
<a href="#section-4.3-1" class="auto internal xref">Section 4.3, Paragraph 1</a>; 
<a href="#section-4.3-2.3.1" class="auto internal xref">Section 4.3, Paragraph 2.3.1</a>; 
<a href="#section-5.2-4" class="auto internal xref">Section 5.2, Paragraph 4</a>; 
<a href="#section-5.3-1" class="auto internal xref">Section 5.3, Paragraph 1</a>; 
<a href="#section-5.3-4" class="auto internal xref">Section 5.3, Paragraph 4</a>; 
<a href="#section-5.3-4" class="auto internal xref">Section 5.3, Paragraph 4</a>; 
<a href="#section-6.1-2" class="auto internal xref">Section 6.1, Paragraph 2</a>; 
<a href="#section-6.6-1" class="auto internal xref">Section 6.6, Paragraph 1</a>; 
<a href="#section-6.6-1" class="auto internal xref">Section 6.6, Paragraph 1</a>; 
<a href="#section-6.9-1" class="auto internal xref">Section 6.9, Paragraph 1</a>; 
<a href="#section-7-1" class="auto internal xref">Section 7, Paragraph 1</a>; 
<a href="#section-7-2" class="auto internal xref">Section 7, Paragraph 2</a>; 
<a href="#section-9.1-1" class="auto internal xref">Section 9.1, Paragraph 1</a>; 
<a href="#section-9.1-2.18.1" class="auto internal xref">Section 9.1, Paragraph 2.18.1</a>; 
<a href="#section-9.5-2.4.1" class="auto internal xref">Section 9.5, Paragraph 2.4.1</a>; 
<a href="#appendix-A-1" class="auto internal xref">Appendix A, Paragraph 1</a>; 
<a href="#appendix-A-4" class="auto internal xref">Appendix A, Paragraph 4</a>; 
<a href="#appendix-A-6" class="auto internal xref">Appendix A, Paragraph 6</a>; 
<a href="#appendix-A-8" class="auto internal xref">Appendix A, Paragraph 8</a><a href="#appendix-C-2.3.2.1.1.2.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="appendix-C-2.3.2.1.1.3">key configurations</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.3.2.1.1.4">
                  <p id="appendix-C-2.3.2.1.1.4.1">
                    <a href="#section-3-2" class="auto internal xref">Section 3, Paragraph 2</a>; 
<a href="#section-3-2" class="auto internal xref">Section 3, Paragraph 2</a>; 
<a href="#section-3-3" class="auto internal xref">Section 3, Paragraph 3</a>; 
<a href="#section-3.2-1" class="auto internal xref">Section 3.2, Paragraph 1</a>; 
<a href="#section-3.2-3" class="auto internal xref">Section 3.2, Paragraph 3</a>; 
<a href="#section-3.2-3" class="auto internal xref">Section 3.2, Paragraph 3</a>; 
<a href="#section-6.1-3" class="auto internal xref">Section 6.1, Paragraph 3</a><a href="#appendix-C-2.3.2.1.1.4.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ul>
</li>
        <li class="normal ulEmpty" id="appendix-C-2.4">
          <div id="rfc.index.u79">
<p id="appendix-C-2.4.1" class="keepWithNext">
            <a href="#rfc.index.u79" class="internal xref">O</a><a href="#appendix-C-2.4.1" class="pilcrow">¶</a></p>
</div>
<ul class="compact normal ulEmpty">
<li class="compact normal ulEmpty" id="appendix-C-2.4.2.1">
              <span class="break"></span><dl class="dlCompact dlParallel" id="appendix-C-2.4.2.1.1">
                <dt id="appendix-C-2.4.2.1.1.1">Oblivious    Gateway Resource</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.4.2.1.1.2">
                  <p id="appendix-C-2.4.2.1.1.2.1">
                    <a href="#section-4.3-9.1.3" class="auto internal xref">Section 4.3, Paragraph 9.1.3</a><a href="#appendix-C-2.4.2.1.1.2.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="appendix-C-2.4.2.1.1.3">Oblivious Gateway Resource</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.4.2.1.1.4">
                  <p id="appendix-C-2.4.2.1.1.4.1">
                    <a href="#section-1-4.2.1" class="auto internal xref">Section 1, Paragraph 4.2.1</a>; 
<a href="#section-1-4.3.1" class="auto internal xref">Section 1, Paragraph 4.3.1</a>; 
<a href="#section-1-5" class="auto internal xref">Section 1, Paragraph 5</a>; 
<a href="#section-1-6" class="auto internal xref">Section 1, Paragraph 6</a>; 
<a href="#section-2-2.1.1" class="auto internal xref">Section 2, Paragraph 2.1.1</a>; 
<a href="#section-2-2.1.1" class="auto internal xref">Section 2, Paragraph 2.1.1</a>; 
<a href="#section-2-2.2.1" class="auto internal xref">Section 2, Paragraph 2.2.1</a>; 
<a href="#section-2-2.3.1" class="auto internal xref">Section 2, Paragraph 2.3.1</a>; 
<a href="#section-2-3" class="auto internal xref">Section 2, Paragraph 3</a>; 
<a href="#section-2-3" class="auto internal xref">Section 2, Paragraph 3</a>; 
<a href="#section-2-3" class="auto internal xref">Section 2, Paragraph 3</a>; 
<a href="#section-2-5" class="auto internal xref">Section 2, Paragraph 5</a>; 
<a href="#section-2-6.5.1" class="auto internal xref">Section 2, Paragraph 6.5.1</a>; 
<a href="#section-2-7" class="auto internal xref">Section 2, Paragraph 7</a>; 
<a href="#section-2-7" class="auto internal xref">Section 2, Paragraph 7</a>; 
<a href="#section-2-8.1.1" class="auto internal xref">Section 2, Paragraph 8.1.1</a>; 
<a href="#section-2-9" class="auto internal xref">Section 2, Paragraph 9</a>; 
<a href="#section-2-9" class="auto internal xref">Section 2, Paragraph 9</a>; 
<a href="#section-2.1-1" class="auto internal xref">Section 2.1, Paragraph 1</a>; 
<a href="#dfn-relay" class="auto internal xref">Section 2.2, Paragraph 3.8.1</a>; 
<a href="#section-2.2-3.9" class="auto internal xref">Section 2.2</a>; 
<a href="#section-3-1" class="auto internal xref">Section 3, Paragraph 1</a>; 
<a href="#section-3.1-5.2.1" class="auto internal xref">Section 3.1, Paragraph 5.2.1</a>; 
<a href="#section-3.1-5.10.1" class="auto internal xref">Section 3.1, Paragraph 5.10.1</a>; 
<a href="#section-4.3-8" class="auto internal xref">Section 4.3, Paragraph 8</a>; 
<a href="#section-4.3-9.1.1" class="auto internal xref">Section 4.3, Paragraph 9.1.1</a>; 
<a href="#section-4.3-9.1.2" class="auto internal xref">Section 4.3, Paragraph 9.1.2</a>; 
<a href="#section-4.3-9.1.3" class="auto internal xref">Section 4.3, Paragraph 9.1.3</a>; 
<a href="#section-4.3-9.4.1" class="auto internal xref">Section 4.3, Paragraph 9.4.1</a>; 
<a href="#section-4.3-12" class="auto internal xref">Section 4.3, Paragraph 12</a>; 
<a href="#section-4.4-1" class="auto internal xref">Section 4.4, Paragraph 1</a>; 
<a href="#section-4.6-1" class="auto internal xref">Section 4.6, Paragraph 1</a>; 
<a href="#section-5-2" class="auto internal xref">Section 5, Paragraph 2</a>; 
<a href="#section-5-2" class="auto internal xref">Section 5, Paragraph 2</a>; 
<a href="#section-5-4" class="auto internal xref">Section 5, Paragraph 4</a>; 
<a href="#section-5-4" class="auto internal xref">Section 5, Paragraph 4</a>; 
<a href="#section-5-5" class="auto internal xref">Section 5, Paragraph 5</a>; 
<a href="#section-5-7" class="auto internal xref">Section 5, Paragraph 7</a>; 
<a href="#section-5-8" class="auto internal xref">Section 5, Paragraph 8</a>; 
<a href="#section-5-9" class="auto internal xref">Section 5, Paragraph 9</a>; 
<a href="#section-5-10" class="auto internal xref">Section 5, Paragraph 10</a>; 
<a href="#section-5.1-2" class="auto internal xref">Section 5.1, Paragraph 2</a>; 
<a href="#section-5.2-2" class="auto internal xref">Section 5.2, Paragraph 2</a>; 
<a href="#section-5.2-3" class="auto internal xref">Section 5.2, Paragraph 3</a>; 
<a href="#section-5.2-3" class="auto internal xref">Section 5.2, Paragraph 3</a>; 
<a href="#section-5.2-4" class="auto internal xref">Section 5.2, Paragraph 4</a>; 
<a href="#section-5.3-1" class="auto internal xref">Section 5.3, Paragraph 1</a>; 
<a href="#section-5.3-4" class="auto internal xref">Section 5.3, Paragraph 4</a>; 
<a href="#section-6-1" class="auto internal xref">Section 6, Paragraph 1</a>; 
<a href="#section-6-3" class="auto internal xref">Section 6, Paragraph 3</a>; 
<a href="#section-6-5.3.1" class="auto internal xref">Section 6, Paragraph 5.3.1</a>; 
<a href="#section-6-6" class="auto internal xref">Section 6, Paragraph 6</a>; 
<a href="#section-6-7" class="auto internal xref">Section 6, Paragraph 7</a>; 
<a href="#section-6-8" class="auto internal xref">Section 6, Paragraph 8</a>; 
<a href="#section-6-8" class="auto internal xref">Section 6, Paragraph 8</a>; 
<a href="#section-6.1-1" class="auto internal xref">Section 6.1, Paragraph 1</a>; 
<a href="#section-6.1-2" class="auto internal xref">Section 6.1, Paragraph 2</a>; 
<a href="#section-6.2-1" class="auto internal xref">Section 6.2, Paragraph 1</a>; 
<a href="#section-6.2-1" class="auto internal xref">Section 6.2, Paragraph 1</a>; 
<a href="#section-6.2.2-1" class="auto internal xref">Section 6.2.2, Paragraph 1</a>; 
<a href="#section-6.2.3-2" class="auto internal xref">Section 6.2.3, Paragraph 2</a>; 
<a href="#section-6.3-1" class="auto internal xref">Section 6.3, Paragraph 1</a>; 
<a href="#section-6.3-1" class="auto internal xref">Section 6.3, Paragraph 1</a>; 
<a href="#section-6.3-1" class="auto internal xref">Section 6.3, Paragraph 1</a>; 
<a href="#section-6.3-4" class="auto internal xref">Section 6.3, Paragraph 4</a>; 
<a href="#section-6.3-4" class="auto internal xref">Section 6.3, Paragraph 4</a>; 
<a href="#section-6.3-4" class="auto internal xref">Section 6.3, Paragraph 4</a>; 
<a href="#section-6.4-1" class="auto internal xref">Section 6.4, Paragraph 1</a>; 
<a href="#section-6.4-1" class="auto internal xref">Section 6.4, Paragraph 1</a>; 
<a href="#section-6.5.1-1" class="auto internal xref">Section 6.5.1, Paragraph 1</a>; 
<a href="#section-6.5.1-3" class="auto internal xref">Section 6.5.1, Paragraph 3</a>; 
<a href="#section-6.5.1-3" class="auto internal xref">Section 6.5.1, Paragraph 3</a>; 
<a href="#section-6.5.1-3" class="auto internal xref">Section 6.5.1, Paragraph 3</a>; 
<a href="#section-6.5.2-1" class="auto internal xref">Section 6.5.2, Paragraph 1</a>; 
<a href="#section-6.5.2-4" class="auto internal xref">Section 6.5.2, Paragraph 4</a>; 
<a href="#section-6.5.2-5" class="auto internal xref">Section 6.5.2, Paragraph 5</a>; 
<a href="#section-6.5.2-7" class="auto internal xref">Section 6.5.2, Paragraph 7</a>; 
<a href="#section-6.5.2-8" class="auto internal xref">Section 6.5.2, Paragraph 8</a>; 
<a href="#section-6.5.2-10" class="auto internal xref">Section 6.5.2, Paragraph 10</a>; 
<a href="#section-6.5.2-10" class="auto internal xref">Section 6.5.2, Paragraph 10</a>; 
<a href="#section-6.7-3" class="auto internal xref">Section 6.7, Paragraph 3</a>; 
<a href="#section-6.9-1" class="auto internal xref">Section 6.9, Paragraph 1</a>; 
<a href="#section-6.10-1" class="auto internal xref">Section 6.10, Paragraph 1</a>; 
<a href="#section-6.10-1" class="auto internal xref">Section 6.10, Paragraph 1</a>; 
<a href="#section-6.10-3" class="auto internal xref">Section 6.10, Paragraph 3</a>; 
<a href="#section-6.10-3" class="auto internal xref">Section 6.10, Paragraph 3</a>; 
<a href="#section-6.10-3" class="auto internal xref">Section 6.10, Paragraph 3</a>; 
<a href="#section-6.10-3" class="auto internal xref">Section 6.10, Paragraph 3</a>; 
<a href="#section-6.10-4" class="auto internal xref">Section 6.10, Paragraph 4</a>; 
<a href="#section-6.10-4" class="auto internal xref">Section 6.10, Paragraph 4</a>; 
<a href="#section-6.10-5" class="auto internal xref">Section 6.10, Paragraph 5</a>; 
<a href="#section-7-1" class="auto internal xref">Section 7, Paragraph 1</a>; 
<a href="#section-7-2" class="auto internal xref">Section 7, Paragraph 2</a>; 
<a href="#section-7-2" class="auto internal xref">Section 7, Paragraph 2</a>; 
<a href="#section-7-2" class="auto internal xref">Section 7, Paragraph 2</a>; 
<a href="#section-8.2-1" class="auto internal xref">Section 8.2, Paragraph 1</a>; 
<a href="#section-8.2-1" class="auto internal xref">Section 8.2, Paragraph 1</a>; 
<a href="#section-8.2-2" class="auto internal xref">Section 8.2, Paragraph 2</a>; 
<a href="#appendix-A-1" class="auto internal xref">Appendix A, Paragraph 1</a>; 
<a href="#appendix-A-2" class="auto internal xref">Appendix A, Paragraph 2</a>; 
<a href="#appendix-A-4" class="auto internal xref">Appendix A, Paragraph 4</a>; 
<a href="#appendix-A-8" class="auto internal xref">Appendix A, Paragraph 8</a>; 
<a href="#appendix-A-18" class="auto internal xref">Appendix A, Paragraph 18</a>; 
<a href="#appendix-A-20" class="auto internal xref">Appendix A, Paragraph 20</a>; 
<a href="#appendix-A-20" class="auto internal xref">Appendix A, Paragraph 20</a>; 
<a href="#appendix-A-34" class="auto internal xref">Appendix A, Paragraph 34</a><a href="#appendix-C-2.4.2.1.1.4.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="appendix-C-2.4.2.1.1.5">Oblivious Gateway Resources</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.4.2.1.1.6">
                  <p id="appendix-C-2.4.2.1.1.6.1">
                    <a href="#section-4.4-1" class="auto internal xref">Section 4.4, Paragraph 1</a>; 
<a href="#section-6-10.1.1" class="auto internal xref">Section 6, Paragraph 10.1.1</a>; 
<a href="#section-6-10.1.1" class="auto internal xref">Section 6, Paragraph 10.1.1</a>; 
<a href="#section-6.1-1" class="auto internal xref">Section 6.1, Paragraph 1</a>; 
<a href="#section-6.1-1" class="auto internal xref">Section 6.1, Paragraph 1</a>; 
<a href="#section-6.2.3-6" class="auto internal xref">Section 6.2.3, Paragraph 6</a>; 
<a href="#section-6.5.1-4" class="auto internal xref">Section 6.5.1, Paragraph 4</a>; 
<a href="#section-6.5.1-5" class="auto internal xref">Section 6.5.1, Paragraph 5</a>; 
<a href="#section-6.5.2-9" class="auto internal xref">Section 6.5.2, Paragraph 9</a>; 
<a href="#section-8.2-1" class="auto internal xref">Section 8.2, Paragraph 1</a>; 
<a href="#section-8.2-1" class="auto internal xref">Section 8.2, Paragraph 1</a>; 
<a href="#section-8.2-2" class="auto internal xref">Section 8.2, Paragraph 2</a><a href="#appendix-C-2.4.2.1.1.6.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="appendix-C-2.4.2.1.1.7">Oblivious Relay and Gateway Resources</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.4.2.1.1.8">
                  <p id="appendix-C-2.4.2.1.1.8.1">
                    <a href="#section-2-2.3.1" class="auto internal xref">Section 2, Paragraph 2.3.1</a>; 
<a href="#section-7-2" class="auto internal xref">Section 7, Paragraph 2</a><a href="#appendix-C-2.4.2.1.1.8.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="appendix-C-2.4.2.1.1.9">Oblivious Relay Resource</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.4.2.1.1.10">
                  <p id="appendix-C-2.4.2.1.1.10.1">
                    <a href="#section-1-4.2.1" class="auto internal xref">Section 1, Paragraph 4.2.1</a>; 
<a href="#section-1-5" class="auto internal xref">Section 1, Paragraph 5</a>; 
<a href="#section-1-6" class="auto internal xref">Section 1, Paragraph 6</a>; 
<a href="#section-1-6" class="auto internal xref">Section 1, Paragraph 6</a>; 
<a href="#section-2-2.3.1" class="auto internal xref">Section 2, Paragraph 2.3.1</a>; 
<a href="#section-2-6.3.1" class="auto internal xref">Section 2, Paragraph 6.3.1</a>; 
<a href="#section-2-6.4.1" class="auto internal xref">Section 2, Paragraph 6.4.1</a>; 
<a href="#section-2-8.1.1" class="auto internal xref">Section 2, Paragraph 8.1.1</a>; 
<a href="#section-2-8.2.1" class="auto internal xref">Section 2, Paragraph 8.2.1</a>; 
<a href="#section-2.1-1" class="auto internal xref">Section 2.1, Paragraph 1</a>; 
<a href="#dfn-client" class="auto internal xref">Section 2.2, Paragraph 3.2.1</a>; 
<a href="#section-2.2-3.7" class="auto internal xref">Section 2.2</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-1" class="auto internal xref">Section 5, Paragraph 1</a>; 
<a href="#section-5-2" class="auto internal xref">Section 5, Paragraph 2</a>; 
<a href="#section-5-2" class="auto internal xref">Section 5, Paragraph 2</a>; 
<a href="#section-5-4" class="auto internal xref">Section 5, Paragraph 4</a>; 
<a href="#section-5-4" class="auto internal xref">Section 5, Paragraph 4</a>; 
<a href="#section-5-4" class="auto internal xref">Section 5, Paragraph 4</a>; 
<a href="#section-5-5" class="auto internal xref">Section 5, Paragraph 5</a>; 
<a href="#section-5-5" class="auto internal xref">Section 5, Paragraph 5</a>; 
<a href="#section-5-6" class="auto internal xref">Section 5, Paragraph 6</a>; 
<a href="#section-5.2-2" class="auto internal xref">Section 5.2, Paragraph 2</a>; 
<a href="#section-5.2-4" class="auto internal xref">Section 5.2, Paragraph 4</a>; 
<a href="#section-5.2-4" class="auto internal xref">Section 5.2, Paragraph 4</a>; 
<a href="#section-5.3-4" class="auto internal xref">Section 5.3, Paragraph 4</a>; 
<a href="#section-6-3" class="auto internal xref">Section 6, Paragraph 3</a>; 
<a href="#section-6-5.2.1" class="auto internal xref">Section 6, Paragraph 5.2.1</a>; 
<a href="#section-6-7" class="auto internal xref">Section 6, Paragraph 7</a>; 
<a href="#section-6-7" class="auto internal xref">Section 6, Paragraph 7</a>; 
<a href="#section-6-8" class="auto internal xref">Section 6, Paragraph 8</a>; 
<a href="#section-6-10.1.1" class="auto internal xref">Section 6, Paragraph 10.1.1</a>; 
<a href="#section-6-10.1.1" class="auto internal xref">Section 6, Paragraph 10.1.1</a>; 
<a href="#section-6.1-3" class="auto internal xref">Section 6.1, Paragraph 3</a>; 
<a href="#section-6.1-6" class="auto internal xref">Section 6.1, Paragraph 6</a>; 
<a href="#section-6.1-6" class="auto internal xref">Section 6.1, Paragraph 6</a>; 
<a href="#section-6.1-6" class="auto internal xref">Section 6.1, Paragraph 6</a>; 
<a href="#section-6.1-7" class="auto internal xref">Section 6.1, Paragraph 7</a>; 
<a href="#section-6.2-1" class="auto internal xref">Section 6.2, Paragraph 1</a>; 
<a href="#section-6.2-2" class="auto internal xref">Section 6.2, Paragraph 2</a>; 
<a href="#section-6.2-3" class="auto internal xref">Section 6.2, Paragraph 3</a>; 
<a href="#section-6.2.3-2" class="auto internal xref">Section 6.2.3, Paragraph 2</a>; 
<a href="#section-6.2.3-5" class="auto internal xref">Section 6.2.3, Paragraph 5</a>; 
<a href="#section-6.2.3-5" class="auto internal xref">Section 6.2.3, Paragraph 5</a>; 
<a href="#section-6.5-2" class="auto internal xref">Section 6.5, Paragraph 2</a>; 
<a href="#section-6.5-4" class="auto internal xref">Section 6.5, Paragraph 4</a>; 
<a href="#section-6.7-4" class="auto internal xref">Section 6.7, Paragraph 4</a>; 
<a href="#section-6.7-4" class="auto internal xref">Section 6.7, Paragraph 4</a>; 
<a href="#section-7-1" class="auto internal xref">Section 7, Paragraph 1</a>; 
<a href="#section-7-2" class="auto internal xref">Section 7, Paragraph 2</a>; 
<a href="#section-7-3" class="auto internal xref">Section 7, Paragraph 3</a>; 
<a href="#section-8.2-1" class="auto internal xref">Section 8.2, Paragraph 1</a>; 
<a href="#section-8.2-1" class="auto internal xref">Section 8.2, Paragraph 1</a>; 
<a href="#section-8.2-1" class="auto internal xref">Section 8.2, Paragraph 1</a>; 
<a href="#appendix-A-1" class="auto internal xref">Appendix A, Paragraph 1</a>; 
<a href="#appendix-A-16" class="auto internal xref">Appendix A, Paragraph 16</a>; 
<a href="#appendix-A-18" class="auto internal xref">Appendix A, Paragraph 18</a>; 
<a href="#appendix-A-36" class="auto internal xref">Appendix A, Paragraph 36</a><a href="#appendix-C-2.4.2.1.1.10.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="appendix-C-2.4.2.1.1.11">Oblivious Relay Resources</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.4.2.1.1.12">
                  <p id="appendix-C-2.4.2.1.1.12.1">
                    <a href="#section-6.2.2-1" class="auto internal xref">Section 6.2.2, Paragraph 1</a>; 
<a href="#section-6.2.3-6" class="auto internal xref">Section 6.2.3, Paragraph 6</a>; 
<a href="#section-6.10-4" class="auto internal xref">Section 6.10, Paragraph 4</a>; 
<a href="#section-8.2-2" class="auto internal xref">Section 8.2, Paragraph 2</a>; 
<a href="#section-8.2-2" class="auto internal xref">Section 8.2, Paragraph 2</a><a href="#appendix-C-2.4.2.1.1.12.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ul>
</li>
        <li class="normal ulEmpty" id="appendix-C-2.5">
          <div id="rfc.index.u84">
<p id="appendix-C-2.5.1" class="keepWithNext">
            <a href="#rfc.index.u84" class="internal xref">T</a><a href="#appendix-C-2.5.1" class="pilcrow">¶</a></p>
</div>
<ul class="compact normal ulEmpty">
<li class="compact normal ulEmpty" id="appendix-C-2.5.2.1">
              <span class="break"></span><dl class="dlCompact dlParallel" id="appendix-C-2.5.2.1.1">
                <dt id="appendix-C-2.5.2.1.1.1">Target Resource</dt>
                <dd style="margin-left: 1.5em" id="appendix-C-2.5.2.1.1.2">
                  <p id="appendix-C-2.5.2.1.1.2.1">
                    <a href="#section-2-3" class="auto internal xref">Section 2, Paragraph 3</a>; 
<a href="#section-2-5" class="auto internal xref">Section 2, Paragraph 5</a>; 
<a href="#section-2-6.1.1" class="auto internal xref">Section 2, Paragraph 6.1.1</a>; 
<a href="#section-2-9" class="auto internal xref">Section 2, Paragraph 9</a>; 
<a href="#section-2-9" class="auto internal xref">Section 2, Paragraph 9</a>; 
<a href="#section-2-9" class="auto internal xref">Section 2, Paragraph 9</a>; 
<a href="#dfn-client" class="auto internal xref">Section 2.2, Paragraph 3.2.1</a>; 
<a href="#dfn-gateway" class="auto internal xref">Section 2.2, Paragraph 3.10.1</a>; 
<a href="#section-2.2-3.11" class="auto internal xref">Section 2.2</a>; 
<a href="#section-5-2" class="auto internal xref">Section 5, Paragraph 2</a>; 
<a href="#section-5-2" class="auto internal xref">Section 5, Paragraph 2</a>; 
<a href="#section-5-2" class="auto internal xref">Section 5, Paragraph 2</a>; 
<a href="#section-5-7" class="auto internal xref">Section 5, Paragraph 7</a>; 
<a href="#section-5-8" class="auto internal xref">Section 5, Paragraph 8</a>; 
<a href="#section-5.2-3" class="auto internal xref">Section 5.2, Paragraph 3</a>; 
<a href="#section-5.2-3" class="auto internal xref">Section 5.2, Paragraph 3</a>; 
<a href="#section-6-1" class="auto internal xref">Section 6, Paragraph 1</a>; 
<a href="#section-6-5.3.1" class="auto internal xref">Section 6, Paragraph 5.3.1</a>; 
<a href="#section-6-6" class="auto internal xref">Section 6, Paragraph 6</a>; 
<a href="#section-6-8" class="auto internal xref">Section 6, Paragraph 8</a>; 
<a href="#section-6.1-1" class="auto internal xref">Section 6.1, Paragraph 1</a>; 
<a href="#section-6.1-1" class="auto internal xref">Section 6.1, Paragraph 1</a>; 
<a href="#section-6.1-3" class="auto internal xref">Section 6.1, Paragraph 3</a>; 
<a href="#section-6.3-1" class="auto internal xref">Section 6.3, Paragraph 1</a>; 
<a href="#section-6.3-1" class="auto internal xref">Section 6.3, Paragraph 1</a>; 
<a href="#section-6.3-4" class="auto internal xref">Section 6.3, Paragraph 4</a>; 
<a href="#section-6.3-4" class="auto internal xref">Section 6.3, Paragraph 4</a>; 
<a href="#section-6.9-3" class="auto internal xref">Section 6.9, Paragraph 3</a>; 
<a href="#section-6.10-1" class="auto internal xref">Section 6.10, Paragraph 1</a>; 
<a href="#section-6.10-3" class="auto internal xref">Section 6.10, Paragraph 3</a>; 
<a href="#section-6.10-3" class="auto internal xref">Section 6.10, Paragraph 3</a>; 
<a href="#section-6.10-3" class="auto internal xref">Section 6.10, Paragraph 3</a>; 
<a href="#section-6.10-3" class="auto internal xref">Section 6.10, Paragraph 3</a>; 
<a href="#section-6.10-4" class="auto internal xref">Section 6.10, Paragraph 4</a>; 
<a href="#section-6.10-5" class="auto internal xref">Section 6.10, Paragraph 5</a>; 
<a href="#appendix-A-1" class="auto internal xref">Appendix A, Paragraph 1</a>; 
<a href="#appendix-A-20" class="auto internal xref">Appendix A, Paragraph 20</a>; 
<a href="#appendix-A-20" class="auto internal xref">Appendix A, Paragraph 20</a><a href="#appendix-C-2.5.2.1.1.2.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ul>
</li>
      </ul>
</section>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Martin Thomson</span></div>
<div dir="auto" class="left"><span class="org">Mozilla</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mt@lowentropy.net" class="email">mt@lowentropy.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
